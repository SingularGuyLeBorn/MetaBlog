# 02-视觉理解

## GLM-4.6V-Flash 模型

### 模型概述

GLM-4.6V-Flash 是 GLM-4.6V 的免费版本，是 GLM 系列在多模态方向上的一次重要迭代。它将训练时上下文窗口提升到 128K，在视觉理解精度上达到同参数规模 SOTA，并首次在模型架构中将 Function Call（工具调用）能力原生融入视觉模型。

### 模型规格

| 规格项 | 数值 |
|:---|:---|
| 输入模态 | 视频、图像、文本、文件 |
| 输出模态 | 文本 |
| 上下文窗口 | 128K tokens |
| 最大输出 Tokens | 32K |
| 图片数量限制 | 最多 50 张 |
| 视频大小限制 | 200MB 以内 |
| 文件数量限制 | 最多 50 个，PDF ≤ 50MB |
| 思考模式 | ✅ 支持（可选） |
| 思维链 | ✅ 支持 |

### 能力支持

- ✅ **深度思考** - 支持开启或关闭思考模式
- ✅ **视觉理解** - 强大的视觉理解能力，支持图片、视频、文件
- ✅ **流式输出** - 支持实时流式响应
- ✅ **Function Call** - 原生多模态工具调用
- ✅ **上下文缓存** - 智能缓存机制，优化长对话性能

### ⚠️ 重要限制

> **不支持同时理解文件、视频和图像** - 每次调用只能选择一种多模态类型

### 适用场景

#### 图片理解

| 典型场景 | 功能项 | 能力描述 |
|:---|:---|:---|
| 发票、证件、手写表单录入 | 通用 OCR 识别 | 支持印刷体、手写体、楷体、艺术字等 |
| 工程造价清单、海关报关单、财务报表 | 复杂表格解析 | 多层表头、合并单元格、跨页表格智能识别 |
| 手机随手拍、现场拍摄单据 | 抗干扰识别 | 应对透视变形、模糊、光照不均、复杂背景等 |
| 商品价格采集、洗衣工厂分拣 | 商品属性识别 | 自动识别品牌、类目、材质、颜色、款式等 |
| 社交平台内容打标、广告素材分析 | 图像内容分析 | 识别场景类型、人物行为、氛围情绪等高阶语义 |
| 手机屏幕质检、商品质控 | 瑕疵缺陷检测 | 检测污渍、破损、变形、色差、划痕等 |

#### 视频理解

| 典型场景 | 功能项 | 能力描述 |
|:---|:---|:---|
| 短视频平台内容分发、视频审核 | 视频内容标签 | 自动识别视频主题、风格、情绪、内容类型 |
| 视频摘要生成、封面推荐 | 关键帧提取 | 智能识别精彩片段、转场点、关键信息帧 |
| 长视频导航、教学视频章节划分 | 事件时间轴构建 | 自动生成时间轴与章节划分，提取关键事件节点 |
| 视频二创、剪辑辅助 | 智能分镜与脚本生成 | 自动切分镜头段落，分析叙事结构 |
| 短视频创作指导、MCN机构选题策划 | 爆款视频热点拆解 | 深度分析爆款视频的成功要素 |

#### 文档/复杂图表问答

| 典型场景 | 优势功能 | 能力描述 |
|:---|:---|:---|
| 合同扫描件、公章盖章文件 | 抗干扰识别 | 穿透红章、斜水印、背景噪声、褶皱污渍等干扰项 |
| 多栏排版、页眉页脚、目录索引 | 版式还原与重构 | 深度理解原文档排版逻辑，输出结构化 JSON/Markdown |
| 长篇合同、多页报表 | 跨页逻辑理解 | 自动识别跨页表格、段落续接、章节延续 |
| 报表数据查询 | 文档智能问答 | 对文档（含复杂的图表、公式数据）进行深度理解 |

### API 调用方式

**端点**：`https://open.bigmodel.cn/api/paas/v4/chat/completions`

### 图片理解示例

```bash
curl -X POST \
https://open.bigmodel.cn/api/paas/v4/chat/completions \
-H "Authorization: Bearer your-api-key" \
-H "Content-Type: application/json" \
-d '{
  "model": "glm-4.6v-flash",
  "messages": [
    {
      "role": "user",
      "content": [
        {
          "type": "image_url",
          "image_url": {
            "url": "https://example.com/image.png"
          }
        },
        {
          "type": "text",
          "text": "请描述这张图片"
        }
      ]
    }
  ],
  "thinking": {
    "type": "enabled"
  }
}'
```

### Python 调用示例

```python
from openai import OpenAI

client = OpenAI(
    api_key="your-api-key",
    base_url="https://open.bigmodel.cn/api/paas/v4"
)

# 单张图片理解
response = client.chat.completions.create(
    model="glm-4.6v-flash",
    messages=[
        {
            "role": "user",
            "content": [
                {
                    "type": "image_url",
                    "image_url": {"url": "https://example.com/image.png"}
                },
                {
                    "type": "text",
                    "text": "请描述这张图片"
                }
            ]
        }
    ]
)

# 多张图片对比
response = client.chat.completions.create(
    model="glm-4.6v-flash",
    messages=[
        {
            "role": "user",
            "content": [
                {"type": "image_url", "image_url": {"url": "https://example.com/img1.png"}},
                {"type": "image_url", "image_url": {"url": "https://example.com/img2.png"}},
                {"type": "text", "text": "对比这两张图片的异同"}
            ]
        }
    ]
)

# 视频理解
response = client.chat.completions.create(
    model="glm-4.6v-flash",
    messages=[
        {
            "role": "user",
            "content": [
                {
                    "type": "video_url",
                    "video_url": {"url": "https://example.com/video.mp4"}
                },
                {
                    "type": "text",
                    "text": "这个视频展示了什么内容？"
                }
            ]
        }
    ]
)

# 文件理解
response = client.chat.completions.create(
    model="glm-4.6v-flash",
    messages=[
        {
            "role": "user",
            "content": [
                {
                    "type": "file_url",
                    "file_url": {"url": "https://example.com/document.pdf"}
                },
                {
                    "type": "text",
                    "text": "请总结这份文档的主要内容"
                }
            ]
        }
    ]
)
```

### Base64 图片输入

```python
import base64

# 读取图片并转换为 base64
with open("image.png", "rb") as img_file:
    img_base64 = base64.b64encode(img_file.read()).decode("utf-8")

response = client.chat.completions.create(
    model="glm-4.6v-flash",
    messages=[
        {
            "role": "user",
            "content": [
                {
                    "type": "image_url",
                    "image_url": {"url": img_base64}  # 直接传 base64 字符串
                },
                {
                    "type": "text",
                    "text": "描述这张图片"
                }
            ]
        }
    ]
)
```

### 注意事项

1. **多模态限制**：每次调用只能选择一种多模态类型（图片、视频、文件不能混用）
2. **图片限制**：最多 50 张图片，每张大小不超过 5MB
3. **视频限制**：大小不超过 200MB，格式支持 mp4、mkv、mov
4. **文件限制**：最多 50 个文件，PDF 不超过 50MB
5. **思考模式**：支持 `thinking` 参数，可获取 `reasoning_content` 思维链

### 与其他视觉模型的区别

| 能力 | GLM-4V-Flash | GLM-4.6V-Flash | GLM-4.1V-Thinking-Flash |
|:---|:---:|:---:|:---:|
| 图片数量 | **仅 1 张** | 最多 50 张 | 最多 50 张 |
| 视频理解 | ❌ | ✅ | ✅ |
| 文件理解 | ❌ | ✅ | ✅ |
| 工具调用 | ❌ | ✅ | ❌ |
| 思考模式 | ❌ | ✅ 可选 | ✅ 强制 |
| Base64 | ❌ | ✅ | ✅ |
| 上下文 | 16K | 128K | 64K |
