# 05-轻量视觉理解

## GLM-4V-Flash 模型

### 模型概述

GLM-4V-Flash 是一款轻量化的多模态理解模型，专为 **轻量级视觉理解** 场景设计。它具备快速响应、高效推理的特点，适合对延迟敏感、成本敏感的应用场景。

### 模型规格

| 规格项 | 数值 |
|:---|:---|
| 输入模态 | 图片、文本 |
| 输出模态 | 文本 |
| 上下文窗口 | 16K tokens |
| 最大输出 Tokens | 1K |
| 图片数量限制 | **仅 1 张** |
| 思考模式 | ❌ 不支持 |
| 思维链 | ❌ 不支持 |

### 能力支持

- ✅ **视觉理解** - 基础图像内容识别
- ✅ **流式输出** - 支持实时流式响应
- ❌ **Function Call** - 不支持工具调用
- ❌ **深度思考** - 不支持思考模式
- ❌ **视频理解** - 不支持视频输入
- ❌ **文件理解** - 不支持文件输入
- ❌ **Base64** - 不支持 base64 编码图片

### ⚠️ 重要限制

| 限制项 | 说明 |
|:---|:---|
| **单图限制** | 每次请求只能处理 **1 张** 图片（相比 4.6V 的 50 张） |
| **URL 限制** | 仅支持图片 URL，**不支持 base64** 编码 |
| **无多模态** | 不支持视频、文件等其他模态 |
| **无工具调用** | 不提供 Function Call 能力 |
| **无思考模式** | 不支持深度推理 |
| **输出较短** | 最大仅 1K tokens 输出 |

### 适用场景

由于模型轻量化的特点，GLM-4V-Flash 适合以下场景：

| 场景类型 | 典型应用 |
|:---|:---|
| **图像内容识别** | 识别图片中的物体、场景、文字 |
| **简单图文问答** | 针对单张图片的简单问答 |
| **图像分类** | 对图片进行类别划分 |
| **实时性要求高的场景** | 需要快速响应的视觉应用 |
| **成本敏感型应用** | 轻量级视觉理解需求 |

### API 调用方式

**端点**：`https://open.bigmodel.cn/api/paas/v4/chat/completions`

### 基础调用示例

```bash
curl -X POST \
https://open.bigmodel.cn/api/paas/v4/chat/completions \
-H "Authorization: Bearer your-api-key" \
-H "Content-Type: application/json" \
-d '{
  "model": "glm-4v-flash",
  "messages": [
    {
      "role": "user",
      "content": [
        {
          "type": "image_url",
          "image_url": {
            "url": "https://example.com/image.png"
          }
        },
        {
          "type": "text",
          "text": "描述这张图片"
        }
      ]
    }
  ]
}'
```

### Python 调用示例

```python
from openai import OpenAI

client = OpenAI(
    api_key="your-api-key",
    base_url="https://open.bigmodel.cn/api/paas/v4"
)

# 单张图片理解
response = client.chat.completions.create(
    model="glm-4v-flash",
    messages=[
        {
            "role": "user",
            "content": [
                {
                    "type": "image_url",
                    "image_url": {"url": "https://example.com/image.png"}
                },
                {
                    "type": "text",
                    "text": "描述这张图片"
                }
            ]
        }
    ]
)

print(response.choices[0].message.content)
```

### 图片分类示例

```python
# 图片分类场景
categories = ["风景", "人物", "动物", "建筑", "食物", "交通工具"]

response = client.chat.completions.create(
    model="glm-4v-flash",
    messages=[
        {
            "role": "user",
            "content": [
                {
                    "type": "image_url",
                    "image_url": {"url": "https://example.com/photo.jpg"}
                },
                {
                    "type": "text",
                    "text": f"请将这张图片分类到以下类别之一：{', '.join(categories)}。只返回类别名称。"
                }
            ]
        }
    ]
)

category = response.choices[0].message.content.strip()
print(f"图片分类: {category}")
```

### 图表分析示例

```python
# 简单图表分析
response = client.chat.completions.create(
    model="glm-4v-flash",
    messages=[
        {
            "role": "user",
            "content": [
                {
                    "type": "image_url",
                    "image_url": {"url": "https://example.com/chart.png"}
                },
                {
                    "type": "text",
                    "text": "这是什么类型的图表？显示了什么数据？"
                }
            ]
        }
    ]
)

print(response.choices[0].message.content)
```

### 流式输出示例

```python
# 流式输出图片分析结果
response = client.chat.completions.create(
    model="glm-4v-flash",
    messages=[
        {
            "role": "user",
            "content": [
                {
                    "type": "image_url",
                    "image_url": {"url": "https://example.com/image.png"}
                },
                {
                    "type": "text",
                    "text": "详细描述这张图片的内容"
                }
            ]
        }
    ],
    stream=True
)

for chunk in response:
    if chunk.choices[0].delta.content:
        print(chunk.choices[0].delta.content, end="", flush=True)
```

### 参数说明

| 参数 | 类型 | 必填 | 说明 |
|:---|:---|:---:|:---|
| model | string | 是 | `glm-4v-flash` |
| messages | array | 是 | 对话消息列表（仅支持单张图片 URL + 文本） |
| max_tokens | integer | 否 | 最大输出 tokens（默认 1024） |
| temperature | float | 否 | 采样温度（默认 0.7） |
| stream | boolean | 否 | 是否流式输出 |

### 注意事项

1. **图片数量限制**：每次调用只能包含 **1 张** 图片，多张会报错
2. **不支持 Base64**：图片必须通过 URL 提供，不支持 base64 编码
3. **仅支持图片**：不支持视频、PDF 等其他多模态输入
4. **输出较短**：最大仅 1K tokens，适合简短回答
5. **无工具调用**：无法结合 Function Call 使用
6. **无思考模式**：不支持深度推理

### 视觉模型对比

| 能力 | GLM-4V-Flash | GLM-4.6V-Flash | GLM-4.1V-Thinking-Flash |
|:---|:---:|:---:|:---:|
| 图片数量 | **1 张** | 50 张 | 50 张 |
| Base64 支持 | ❌ | ✅ | ✅ |
| 视频理解 | ❌ | ✅ | ✅ |
| 文件理解 | ❌ | ✅ | ✅ |
| 工具调用 | ❌ | ✅ | ❌ |
| 思考模式 | ❌ | ✅ 可选 | ✅ 强制 |
| 上下文 | 16K | 128K | 64K |
| 最大输出 | 1K | 32K | 16K |
| 响应速度 | ⚡ 最快 | 快 | 中等 |

### 使用建议

- ✅ 适合：简单的图像识别、快速响应的场景
- ✅ 适合：单图问答、图像分类
- ❌ 不适合：需要多图对比、视频分析、深度推理的场景
- ❌ 不适合：需要工具调用、文件处理的任务
