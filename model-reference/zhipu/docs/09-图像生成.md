# 图像生成（Image Generation）

## 功能介绍

图像生成（Image Generation）是智谱 AI 提供的一项强大的 AI 图像创作服务，能够根据用户提供的文本描述（提示词）自动生成高质量、多样化的图像。该服务基于 CogView-3-Flash 模型，具有创意丰富、推理快速的特点，适合各种创意设计和内容创作场景。

与对话模型不同，图像生成使用独立的 API 端点 `/images/generations`，专门针对图像创作进行了优化。

## 适用场景

图像生成功能可广泛应用于以下场景：

| 场景 | 说明 | 示例提示词 |
|:---|:---|:---|
| **艺术创作** | 生成原创艺术作品、插画、概念设计 | "一幅未来城市的赛博朋克风格画作，霓虹灯闪烁，雨中街道" |
| **设计辅助** | 为设计师提供灵感素材、草图参考 | "极简主义风格的产品展示背景，白色大理石纹理" |
| **内容营销** | 生成营销配图、社交媒体素材 | "一张展示健康早餐的精美照片，包含水果、麦片和咖啡" |
| **教育培训** | 制作教学配图、可视化内容 | "展示地球水循环过程的科学插图，带有标注" |
| **游戏开发** | 生成游戏角色、场景概念图 | "一个身穿重甲的骑士，站在龙穴入口，史诗奇幻风格" |
| **电子商务** | 生成产品展示图、场景图 | "一款现代无线耳机的产品照片，白色背景，专业打光" |

## 支持的模型

| 模型 | 模型代码 | 类型 | 思考模式 | 思维链 |
|:---|:---|:---|:---:|:---:|
| CogView-3-Flash | cogview-3-flash | 图像生成 | N/A | N/A |

**说明：**
- CogView-3-Flash 是专门的图像生成模型
- 不属于对话模型，不支持思考模式和思维链
- 使用独立的 `/images/generations` 端点

## 支持的尺寸

CogView-3-Flash 支持多种图像分辨率，可根据不同用途选择合适的尺寸：

| 分辨率 | 比例 | 适用场景 |
|:---:|:---:|:---|
| 1024×1024 | 1:1 | 社交媒体头像、商品主图、Instagram 帖子 |
| 1024×768 | 4:3 | 演示文稿、网页配图、博客封面 |
| 768×1024 | 3:4 | 手机壁纸、小红书配图、竖版海报 |
| 512×512 | 1:1 | 图标、缩略图、快速预览 |

## API 调用方式

### 与对话 API 的区别

| 特性 | 图像生成 API | 对话 API |
|:---|:---|:---|
| **端点** | `/images/generations` | `/chat/completions` |
| **模型类型** | 图像生成模型 | 对话/文本模型 |
| **响应格式** | 图片 URL 或 Base64 | 文本内容 |
| **参数** | prompt, size, quality, style | messages, temperature, max_tokens |
| **使用场景** | 生成图像 | 生成文本对话 |
| **思考模式** | 不支持 | 部分模型支持 |
| **思维链** | 不支持 | 部分模型支持 |

### 请求示例

```python
import requests

response = requests.post(
    "https://open.bigmodel.cn/api/paas/v4/images/generations",
    headers={"Authorization": "Bearer YOUR_API_KEY"},
    json={
        "model": "cogview-3-flash",
        "prompt": "一片宁静的湖面，倒映着雪山，日落时分，金色光芒",
        "size": "1024x1024"
    }
)

# 获取生成的图片 URL
image_url = response.json()["data"][0]["url"]
```

## 参数说明

| 参数 | 类型 | 必填 | 默认值 | 说明 |
|:---|:---|:---:|:---:|:---|
| `model` | string | 是 | - | 模型代码，固定为 `cogview-3-flash` |
| `prompt` | string | 是 | - | 图像描述提示词，建议使用英文，长度建议 100-500 字符 |
| `size` | string | 否 | 1024x1024 | 图像尺寸，可选值：`1024x1024`, `1024x768`, `768x1024`, `512x512` |
| `n` | integer | 否 | 1 | 生成图像数量，范围 1-4 |
| `quality` | string | 否 | standard | 图像质量，可选值：`standard`（标准）, `hd`（高清） |
| `style` | string | 否 | 自动 | 图像风格，可选值：`natural`（自然/写实）, `vivid`（生动/鲜艳）, `anime`（动漫）, `oil_painting`（油画）等 |
| `response_format` | string | 否 | url | 返回格式，可选值：`url`（图片链接）, `b64_json`（Base64 编码） |

### 参数详细说明

#### prompt（提示词）

提示词的质量直接影响生成图像的效果。建议遵循以下原则：

- **具体描述**：详细描述主体、场景、光线、色彩等
- **使用英文**：英文提示词通常效果更好
- **添加风格词**：如 "digital art", "oil painting", "photorealistic"
- **指定质量词**：如 "high quality", "detailed", "4K", "masterpiece"

#### quality（质量）

- `standard`：标准质量，生成速度快，适合快速迭代
- `hd`：高清质量，细节更丰富，生成时间稍长

#### style（风格）

可以通过 `style` 参数或直接在 `prompt` 中指定风格：

- `natural` / `photorealistic`：写实摄影风格
- `vivid` / `digital art`：数字艺术风格，色彩鲜艳
- `anime` / `manga`：日式动漫风格
- `oil_painting`：油画风格
- `watercolor`：水彩风格
- `sketch` / `pencil drawing`：素描风格

## 提示词编写技巧

### 1. 结构化提示词公式

```
[主体] + [细节描述] + [场景/环境] + [光线/氛围] + [风格/媒介] + [质量修饰词]
```

### 2. 示例提示词拆解

**示例**："A majestic white tiger standing on a rocky cliff, snow-capped mountains in the background, golden hour lighting, photorealistic style, highly detailed, 8K resolution, national geographic quality"

| 部分 | 内容 |
|:---|:---|
| 主体 | A majestic white tiger |
| 细节 | standing on a rocky cliff |
| 场景 | snow-capped mountains in the background |
| 光线 | golden hour lighting |
| 风格 | photorealistic style |
| 质量 | highly detailed, 8K resolution, national geographic quality |

### 3. 常用修饰词

| 类别 | 推荐词汇 |
|:---|:---|
| 质量 | masterpiece, best quality, highly detailed, 4K, 8K, ultra HD, sharp focus |
| 光线 | soft lighting, golden hour, dramatic lighting, studio lighting, natural light |
| 视角 | wide angle, close-up, aerial view, portrait, landscape, top-down view |
| 氛围 | dreamy, cinematic, atmospheric, moody, vibrant, serene |

## 代码示例

### Python 基础示例

```python
import requests
from PIL import Image
from io import BytesIO

class ZhipuImageGenerator:
    def __init__(self, api_key: str):
        self.api_key = api_key
        self.base_url = "https://open.bigmodel.cn/api/paas/v4"
    
    def generate(
        self,
        prompt: str,
        size: str = "1024x1024",
        n: int = 1,
        quality: str = "standard",
        style: str = None
    ) -> list:
        """生成图像"""
        headers = {
            "Authorization": f"Bearer {self.api_key}",
            "Content-Type": "application/json"
        }
        
        payload = {
            "model": "cogview-3-flash",
            "prompt": prompt,
            "size": size,
            "n": n,
            "quality": quality
        }
        
        if style:
            payload["style"] = style
        
        response = requests.post(
            f"{self.base_url}/images/generations",
            headers=headers,
            json=payload
        )
        response.raise_for_status()
        
        return response.json()["data"]
    
    def generate_and_display(self, prompt: str, **kwargs):
        """生成并显示图像"""
        images = self.generate(prompt, **kwargs)
        
        for img_data in images:
            img_url = img_data["url"]
            img_response = requests.get(img_url)
            img = Image.open(BytesIO(img_response.content))
            img.show()
        
        return images

# 使用示例
generator = ZhipuImageGenerator("YOUR_API_KEY")

# 生成风景图
images = generator.generate(
    prompt="A serene mountain lake at sunrise, mist rising from the water, pine trees on the shore, reflection of snow-capped peaks, photorealistic, highly detailed, 8K",
    size="1024x1024",
    quality="hd"
)
print(f"Generated image URL: {images[0]['url']}")
```

### 批量生成示例

```python
prompts = [
    "A cozy coffee shop interior, warm lighting, wooden furniture, barista making latte art, morning atmosphere",
    "Futuristic cityscape at night, flying cars, neon lights, cyberpunk style, rain-slicked streets",
    "A peaceful Japanese garden, cherry blossoms, koi pond, stone lantern, spring morning"
]

for prompt in prompts:
    images = generator.generate(prompt=prompt, size="1024x768")
    print(f"Prompt: {prompt[:50]}... -> URL: {images[0]['url']}")
```

### 不同风格对比

```python
styles = ["natural", "vivid", "anime", "oil_painting"]
base_prompt = "A mystical forest with glowing mushrooms, fairy lights, magical atmosphere"

for style in styles:
    images = generator.generate(
        prompt=f"{base_prompt}, {style} style",
        style=style,
        size="1024x1024"
    )
    print(f"Style: {style} -> {images[0]['url']}")
```

## 注意事项

1. **API 端点独立**：图像生成使用 `/images/generations` 端点，与对话 API 不同
2. **提示词语言**：虽然支持中文提示词，但英文提示词通常效果更好
3. **生成时间**：图像生成需要一定时间（通常 5-15 秒），请合理设置超时时间
4. **内容安全**：生成的内容需遵守相关法律法规，避免生成不当内容
5. **图片保存**：生成的图片 URL 有一定有效期，建议及时下载保存
6. **频率限制**：免费版有调用频率限制，高并发场景请注意控制请求频率
7. **网络稳定性**：图片生成和下载依赖网络，弱网环境下可能失败
8. **成本控制**：虽然是免费模型，但仍建议合理使用，避免不必要的浪费
9. **结果不确定性**：同一提示词多次生成结果可能不同，可通过调整 `seed`（如支持）获得稳定输出
10. **提示词长度**：提示词过长可能影响效果，建议控制在合理范围内（100-500 字符）
11. **思考模式不适用**：CogView-3-Flash 是图像生成模型，不支持思考模式和思维链

## 参考资源

- [智谱 AI 官方文档](https://open.bigmodel.cn/dev/howuse/cogview)
- [CogView-3-Flash 模型介绍](https://open.bigmodel.cn/modelcenter/cogview-3-flash)
