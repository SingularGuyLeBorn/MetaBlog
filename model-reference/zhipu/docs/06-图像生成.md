# 06-图像生成

## CogView-3-Flash 模型

### 模型概述

CogView-3-Flash 是智谱 AI 基于 CogView-3 部署的开源免费模型，是一款高效生成图像的 AI 工具。它具备图像生成速度快、质量高、支持多种图像尺寸和风格等特点，完全免费调用。

### 模型规格

| 规格项 | 说明 |
|:---|:---|
| 输入模态 | 文本 |
| 输出模态 | 图像 |
| 计费方式 | **免费** |
| 单账号速率限制 | 10 张/秒 |
| 并发限制 | 10 张/秒 |
| 单账号每日额度 | 10,000 张 |

### 支持的分辨率

CogView-3-Flash 支持以下 7 种图像分辨率：

| 分辨率 | 比例 | 适用场景 |
|:---|:---:|:---|
| 1024x1024 | 1:1 | 头像、图标、正方形图片 |
| 768x1344 | 9:16 | 手机壁纸、竖屏海报、短视频封面 |
| 1344x768 | 16:9 | 电脑壁纸、横屏视频封面、PPT 背景 |
| 864x1152 | 3:4 | 传统照片比例、社交媒体图片 |
| 1152x864 | 4:3 | 幻灯片、文档配图、传统显示器比例 |
| 1440x720 | 2:1 | 超宽屏、横幅、网站头部背景 |
| 720x1440 | 1:2 | 长图、海报、竖版宣传图 |

### 能力支持

- ✅ **文生图** - 通过文本描述生成高质量图像
- ✅ **多种分辨率** - 支持 7 种不同比例的图像尺寸
- ✅ **多种风格** - 支持不同艺术风格的图像生成
- ✅ **快速生成** - 平均生成时间约 5-10 秒

### 适用场景

| 场景类型 | 应用示例 |
|:---|:---|
| **头像生成** | 个性化头像、社交媒体头像 |
| **壁纸制作** | 手机壁纸、电脑桌面、锁屏壁纸 |
| **设计素材** | 海报背景、产品展示图、网站配图 |
| **创意插画** | 故事配图、概念设计、艺术创作 |
| **营销素材** | 广告图片、商品展示、宣传海报 |
| **社交媒体** | 朋友圈配图、公众号封面、小红书图片 |

### API 调用方式

**端点**：`https://open.bigmodel.cn/api/paas/v4/images/generations`

**请求方式**：POST

**认证方式**：Bearer Token

### 基础调用示例

```bash
curl -X POST \
https://open.bigmodel.cn/api/paas/v4/images/generations \
-H "Authorization: Bearer your-api-key" \
-H "Content-Type: application/json" \
-d '{
  "model": "cogview-3-flash",
  "prompt": "一只可爱的橘猫坐在窗台上，阳光透过窗户洒进来，温馨的氛围"
}'
```

### Python 调用示例

```python
from openai import OpenAI

client = OpenAI(
    api_key="your-api-key",
    base_url="https://open.bigmodel.cn/api/paas/v4"
)

# 基础图像生成
response = client.images.generate(
    model="cogview-3-flash",
    prompt="一只可爱的橘猫坐在窗台上，阳光透过窗户洒进来，温馨的氛围"
)

image_url = response.data[0].url
print(f"生成的图片 URL: {image_url}")

# 查看图片
display(Image(url=image_url))
```

### 指定分辨率

```python
# 生成手机壁纸（竖屏）
response = client.images.generate(
    model="cogview-3-flash",
    prompt="一幅美丽的山水画，有瀑布和云雾，水墨画风格",
    size="768x1344"  # 竖屏 9:16 比例
)

image_url = response.data[0].url
print(f"竖屏图片 URL: {image_url}")

# 生成电脑壁纸（横屏）
response = client.images.generate(
    model="cogview-3-flash",
    prompt="星空下的雪山，极光闪烁，超现实主义风格",
    size="1344x768"  # 横屏 16:9 比例
)

image_url = response.data[0].url
print(f"横屏图片 URL: {image_url}")

# 生成正方形图片
response = client.images.generate(
    model="cogview-3-flash",
    prompt="一个简约的logo，几何图形，蓝色调",
    size="1024x1024"  # 1:1 比例
)

image_url = response.data[0].url
print(f"正方形图片 URL: {image_url}")
```

### 批量生成

```python
import time

prompts = [
    "春天樱花盛开的日本街道，粉色花瓣飘落",
    "未来科技城市，霓虹灯光，赛博朋克风格",
    "夏日海滩日落，椰子树，金色阳光"
]

images = []
for prompt in prompts:
    try:
        response = client.images.generate(
            model="cogview-3-flash",
            prompt=prompt,
            size="1024x1024"
        )
        images.append({
            "prompt": prompt,
            "url": response.data[0].url
        })
        print(f"生成完成: {prompt[:20]}...")
        time.sleep(1)  # 避免请求过快
    except Exception as e:
        print(f"生成失败: {e}")

print(f"成功生成 {len(images)} 张图片")
```

### 下载和保存图片

```python
import requests
from PIL import Image as PILImage
from io import BytesIO
import os

def generate_and_save(prompt, filename, size="1024x1024", output_dir="./generated_images"):
    """
    生成图片并保存到本地
    
    Args:
        prompt: 图片描述
        filename: 保存的文件名
        size: 图片尺寸
        output_dir: 输出目录
    """
    # 创建输出目录
    os.makedirs(output_dir, exist_ok=True)
    
    # 生成图片
    response = client.images.generate(
        model="cogview-3-flash",
        prompt=prompt,
        size=size
    )
    
    image_url = response.data[0].url
    
    # 下载图片
    image_response = requests.get(image_url)
    img = PILImage.open(BytesIO(image_response.content))
    
    # 保存图片
    filepath = os.path.join(output_dir, filename)
    img.save(filepath)
    print(f"图片已保存: {filepath}")
    
    return img

# 使用示例
generate_and_save(
    prompt="一只穿着西装的柴犬，商务风格，卡通",
    filename="business_shiba.jpg",
    size="1024x1024"
)
```

### 参数说明

| 参数 | 类型 | 必填 | 说明 |
|:---|:---|:---:|:---|
| model | string | 是 | `cogview-3-flash` |
| prompt | string | 是 | 图像生成提示词（支持中英文） |
| size | string | 否 | 图像尺寸，默认 `1024x1024` |
| n | integer | 否 | 生成数量，默认 1（建议保持为 1） |
| quality | string | 否 | 图像质量：`standard`（默认）或 `hd` |
| style | string | 否 | 图像风格：`vivid`（默认）或 `natural` |

### 提示词技巧

#### 有效的提示词结构

```
[主体描述] + [场景环境] + [风格/艺术效果] + [光线/氛围]
```

#### 示例提示词

```python
# 高质量提示词示例
prompts = {
    "风景": "雪山日出，金色阳光洒在山峰上，晨雾缭绕，高清摄影风格，8K画质",
    
    "人物": "一位穿着汉服的中国古代女子，站在樱花树下，微笑，古风插画风格，柔和光线",
    
    "建筑": "现代摩天大楼，玻璃幕墙反射蓝天白云，建筑摄影，广角镜头，蓝天",
    
    "产品": "白色无线耳机，精致的产品摄影，纯黑背景，专业灯光，商业广告风格",
    
    "艺术": "抽象油画，蓝色和紫色的漩涡，梵高风格，表现主义，画布纹理"
}
```

### 注意事项

1. **速率限制**：单账号限制 **10 张/秒**，单账号每天最多 **10,000 张**
2. **提示词质量**：描述越详细、具体，生成效果越好
3. **中英文支持**：提示词支持中文和英文
4. **图片格式**：返回的图片为 PNG 格式
5. **图片有效期**：生成的图片 URL 通常有有效期，建议及时下载保存
6. **内容规范**：遵守内容安全规范，避免生成违规内容

### 与 CogView-3 的区别

| 特性 | CogView-3 | CogView-3-Flash |
|:---|:---:|:---:|
| 费用 | 收费 | **免费** |
| 速率限制 | 更高 | 10 张/秒 |
| 图片质量 | 略高 | 良好 |
| 生成速度 | 正常 | 较快 |

### 不同分辨率效果对比

```python
prompt = "一座古典欧式建筑，喷泉，花园，阳光明媚"

sizes = ["1024x1024", "768x1344", "1344x768", "864x1152", "1152x864"]

for size in sizes:
    response = client.images.generate(
        model="cogview-3-flash",
        prompt=prompt,
        size=size
    )
    print(f"分辨率 {size}: {response.data[0].url}")
```
