# 07-è§†é¢‘ç”Ÿæˆ

## CogVideoX-Flash æ¨¡å‹

### æ¨¡å‹æ¦‚è¿°

CogVideoX-Flash æ˜¯æ™ºè°± AI æ¨å‡ºçš„ **ä¸šç•Œé¦–ä¸ªå…è´¹è§†é¢‘ç”Ÿæˆ API**ï¼ŒåŸºäº CogVideoX æ¶æ„ä¼˜åŒ–ï¼Œæä¾›é«˜æ•ˆã€ä¾¿æ·çš„è§†é¢‘ç”Ÿæˆèƒ½åŠ›ã€‚è¯¥æ¨¡å‹å®Œå…¨å…è´¹è°ƒç”¨ï¼Œé€‚åˆå¼€å‘è€…å¿«é€Ÿæ„å»ºè§†é¢‘ç”Ÿæˆåº”ç”¨ã€‚

### æ¨¡å‹è§„æ ¼

| è§„æ ¼é¡¹ | è¯´æ˜ |
|:---|:---|
| è¾“å…¥æ¨¡æ€ | æ–‡æœ¬ã€å›¾ç‰‡ï¼ˆå¯é€‰é¦–å¸§ï¼‰ |
| è¾“å‡ºæ¨¡æ€ | è§†é¢‘ï¼ˆMP4ï¼‰ |
| è®¡è´¹æ–¹å¼ | **å…è´¹** |
| ç”Ÿæˆæ–¹å¼ | **å¼‚æ­¥ API**ï¼ˆæäº¤ä»»åŠ¡ â†’ æŸ¥è¯¢ç»“æœï¼‰ |
| å…¸å‹ç”Ÿæˆæ—¶é•¿ | 1-5 åˆ†é’Ÿ |

### ç”Ÿæˆæ–¹å¼

CogVideoX-Flash é‡‡ç”¨ **å¼‚æ­¥ API** æ¨¡å¼ï¼š

1. **æäº¤ä»»åŠ¡** - è°ƒç”¨æ¥å£æäº¤è§†é¢‘ç”Ÿæˆè¯·æ±‚ï¼Œè·å– `task_id`
2. **è½®è¯¢çŠ¶æ€** - å®šæœŸæŸ¥è¯¢ä»»åŠ¡çŠ¶æ€
3. **è·å–ç»“æœ** - ä»»åŠ¡å®Œæˆåï¼Œè·å–è§†é¢‘ URL

### æ”¯æŒçš„åŠŸèƒ½

- âœ… **æ–‡ç”Ÿè§†é¢‘** - é€šè¿‡æ–‡æœ¬æè¿°ç”Ÿæˆè§†é¢‘
- âœ… **å›¾ç”Ÿè§†é¢‘** - ä»¥å›¾ç‰‡ä½œä¸ºé¦–å¸§ç”Ÿæˆè§†é¢‘
- âœ… **å¤šç§åˆ†è¾¨ç‡** - æ”¯æŒå¤šç§è§†é¢‘å°ºå¯¸
- âœ… **å¯æ§æ—¶é•¿** - ç”Ÿæˆå›ºå®šé•¿åº¦çš„è§†é¢‘ç‰‡æ®µ

### é€‚ç”¨åœºæ™¯

| åœºæ™¯ç±»å‹ | åº”ç”¨ç¤ºä¾‹ |
|:---|:---|
| **çŸ­è§†é¢‘åˆ›ä½œ** | ç¤¾äº¤åª’ä½“çŸ­è§†é¢‘ã€è¥é”€è§†é¢‘ |
| **åŠ¨ç”»åˆ¶ä½œ** | æ¦‚å¿µåŠ¨ç”»ã€æ¼”ç¤ºåŠ¨ç”» |
| **è§†é¢‘ç´ æ** | èƒŒæ™¯è§†é¢‘ã€è½¬åœºç´ æ |
| **åˆ›æ„å±•ç¤º** | äº§å“å±•ç¤ºã€åœºæ™¯æ¨¡æ‹Ÿ |
| **æ•™è‚²åŸ¹è®­** | æ•™å­¦æ¼”ç¤ºã€è¿‡ç¨‹å±•ç¤º |

### API è°ƒç”¨æ–¹å¼

**ä»»åŠ¡æäº¤ç«¯ç‚¹**ï¼š`https://open.bigmodel.cn/api/paas/v4/videos/generations`

**ä»»åŠ¡æŸ¥è¯¢ç«¯ç‚¹**ï¼š`https://open.bigmodel.cn/api/paas/v4/async-result/{task_id}`

**è¯·æ±‚æ–¹å¼**ï¼šPOSTï¼ˆæäº¤ï¼‰ã€GETï¼ˆæŸ¥è¯¢ï¼‰

**è®¤è¯æ–¹å¼**ï¼šBearer Token

### åŸºç¡€è°ƒç”¨ç¤ºä¾‹ï¼ˆHTTPï¼‰

#### 1. æäº¤è§†é¢‘ç”Ÿæˆä»»åŠ¡

```bash
curl -X POST \
https://open.bigmodel.cn/api/paas/v4/videos/generations \
-H "Authorization: Bearer your-api-key" \
-H "Content-Type: application/json" \
-d '{
  "model": "cogvideox-flash",
  "prompt": "ä¸€åªæŸ´çŠ¬åœ¨è‰åœ°ä¸Šå¥”è·‘ï¼Œé˜³å…‰æ˜åªšï¼Œè“å¤©"
}'
```

å“åº”ç¤ºä¾‹ï¼š
```json
{
  "request_id": "req_xxx",
  "id": "xxx",
  "model": "cogvideox-flash",
  "task_status": "PROCESSING",
  "created": 1234567890
}
```

#### 2. æŸ¥è¯¢ä»»åŠ¡çŠ¶æ€

```bash
curl -X GET \
https://open.bigmodel.cn/api/paas/v4/async-result/{task_id} \
-H "Authorization: Bearer your-api-key"
```

å“åº”ç¤ºä¾‹ï¼š
```json
{
  "request_id": "req_xxx",
  "task_id": "xxx",
  "model": "cogvideox-flash",
  "task_status": "SUCCESS",
  "video_result": [
    {"url": "https://...", "cover_image_url": "https://..."}
  ]
}
```

### Python è°ƒç”¨ç¤ºä¾‹

```python
from openai import OpenAI
import time

client = OpenAI(
    api_key="your-api-key",
    base_url="https://open.bigmodel.cn/api/paas/v4"
)

def generate_video(prompt, size="1024x1024", image_url=None):
    """
    ç”Ÿæˆè§†é¢‘å¹¶ç­‰å¾…å®Œæˆ
    
    Args:
        prompt: è§†é¢‘æè¿°æç¤ºè¯
        size: è§†é¢‘å°ºå¯¸
        image_url: é¦–å¸§å›¾ç‰‡ URLï¼ˆå¯é€‰ï¼‰
    
    Returns:
        è§†é¢‘ URL å’Œå°é¢å›¾ URL
    """
    # 1. æäº¤ä»»åŠ¡
    print(f"ğŸ¬ æäº¤è§†é¢‘ç”Ÿæˆä»»åŠ¡...")
    print(f"   æç¤ºè¯: {prompt}")
    
    body = {
        "model": "cogvideox-flash",
        "prompt": prompt
    }
    
    if image_url:
        body["image_url"] = image_url
    
    response = client.post(
        path="videos/generations",
        cast_to=dict,
        body=body
    )
    
    task_id = response.get("id")
    if not task_id:
        raise Exception(f"æäº¤ä»»åŠ¡å¤±è´¥: {response}")
    
    print(f"   ä»»åŠ¡ID: {task_id}")
    
    # 2. è½®è¯¢ç­‰å¾…å®Œæˆ
    max_attempts = 60  # æœ€å¤šç­‰å¾… 10 åˆ†é’Ÿ
    for attempt in range(max_attempts):
        time.sleep(10)  # æ¯ 10 ç§’æŸ¥è¯¢ä¸€æ¬¡
        
        result = client.get(
            path=f"async-result/{task_id}",
            cast_to=dict
        )
        
        status = result.get("task_status", "UNKNOWN")
        print(f"   çŠ¶æ€æ£€æŸ¥ {attempt + 1}/{max_attempts}: {status}")
        
        if status == "SUCCESS":
            video_url = result["video_result"][0]["url"]
            cover_url = result["video_result"][0].get("cover_image_url")
            print(f"âœ… è§†é¢‘ç”Ÿæˆå®Œæˆ!")
            return video_url, cover_url
        
        elif status in ["FAIL", "FAILED"]:
            raise Exception(f"è§†é¢‘ç”Ÿæˆå¤±è´¥: {result}")
        
        elif status in ["PROCESSING", "PENDING"]:
            continue  # ç»§ç»­ç­‰å¾…
        
        else:
            print(f"   æœªçŸ¥çŠ¶æ€: {status}")
    
    raise TimeoutError("è§†é¢‘ç”Ÿæˆè¶…æ—¶")

# ä½¿ç”¨ç¤ºä¾‹
try:
    video_url, cover_url = generate_video(
        prompt="ä¸€åªæŸ´çŠ¬åœ¨è‰åœ°ä¸Šå¥”è·‘ï¼Œé˜³å…‰æ˜åªšï¼Œè“å¤©"
    )
    print(f"\nè§†é¢‘åœ°å€: {video_url}")
    if cover_url:
        print(f"å°é¢åœ°å€: {cover_url}")
except Exception as e:
    print(f"é”™è¯¯: {e}")
```

### æ–‡ç”Ÿè§†é¢‘ç¤ºä¾‹

```python
# çº¯æ–‡æœ¬ç”Ÿæˆè§†é¢‘
prompt = "ä¸€ä½å®‡èˆªå‘˜åœ¨æœˆçƒè¡¨é¢è¡Œèµ°ï¼Œåœ°çƒåœ¨èƒŒæ™¯ä¸­å‡èµ·ï¼Œç§‘å¹»é£æ ¼ï¼Œ4Kç”»è´¨"

try:
    video_url, cover_url = generate_video(prompt=prompt)
    print(f"è§†é¢‘å·²ç”Ÿæˆ: {video_url}")
    
    # æ˜¾ç¤ºå°é¢
    display(Image(url=cover_url))
except Exception as e:
    print(f"ç”Ÿæˆå¤±è´¥: {e}")
```

### å›¾ç”Ÿè§†é¢‘ç¤ºä¾‹

```python
# ä»¥å›¾ç‰‡ä¸ºé¦–å¸§ç”Ÿæˆè§†é¢‘
prompt = "è®©è¿™å¼ å›¾ç‰‡åŠ¨èµ·æ¥ï¼Œå±•ç¤ºåŠ¨æ€æ•ˆæœ"
image_url = "https://example.com/static_image.png"  # é¦–å¸§å›¾ç‰‡

try:
    video_url, cover_url = generate_video(
        prompt=prompt,
        image_url=image_url
    )
    print(f"è§†é¢‘å·²ç”Ÿæˆ: {video_url}")
except Exception as e:
    print(f"ç”Ÿæˆå¤±è´¥: {e}")
```

### æ‰¹é‡ç”Ÿæˆç¤ºä¾‹

```python
prompts = [
    "æ¨±èŠ±é£˜è½ï¼Œæ—¥æœ¬è¡—é“ï¼Œæ˜¥å¤©æ°›å›´",
    "æµ·æµªæ‹æ‰“ç¤çŸ³ï¼Œå¤•é˜³ä¸‹çš„æµ·æ»©",
    "åŸå¸‚å¤œæ™¯ï¼Œè½¦æµç¯å…‰è½¨è¿¹ï¼Œå»¶æ—¶æ‘„å½±"
]

results = []
for i, prompt in enumerate(prompts):
    print(f"\n[{i+1}/{len(prompts)}] ç”Ÿæˆè§†é¢‘...")
    try:
        video_url, cover_url = generate_video(prompt)
        results.append({
            "prompt": prompt,
            "video_url": video_url,
            "cover_url": cover_url
        })
        print(f"   âœ… æˆåŠŸ")
    except Exception as e:
        print(f"   âŒ å¤±è´¥: {e}")
    
    if i < len(prompts) - 1:
        time.sleep(5)  # ä»»åŠ¡é—´éš”

print(f"\nå…±æˆåŠŸç”Ÿæˆ {len(results)} ä¸ªè§†é¢‘")
```

### é«˜çº§å¼‚æ­¥å¤„ç†ç¤ºä¾‹

```python
import concurrent.futures
from typing import List, Dict

class VideoGenerator:
    """è§†é¢‘ç”Ÿæˆå™¨ - æ”¯æŒæ‰¹é‡å’Œå¹¶å‘"""
    
    def __init__(self, api_key: str):
        self.client = OpenAI(
            api_key=api_key,
            base_url="https://open.bigmodel.cn/api/paas/v4"
        )
    
    def submit_task(self, prompt: str, image_url: str = None) -> str:
        """æäº¤è§†é¢‘ç”Ÿæˆä»»åŠ¡"""
        body = {"model": "cogvideox-flash", "prompt": prompt}
        if image_url:
            body["image_url"] = image_url
        
        response = self.client.post(
            path="videos/generations",
            cast_to=dict,
            body=body
        )
        return response.get("id")
    
    def check_task(self, task_id: str) -> Dict:
        """æŸ¥è¯¢ä»»åŠ¡çŠ¶æ€"""
        return self.client.get(
            path=f"async-result/{task_id}",
            cast_to=dict
        )
    
    def wait_for_completion(self, task_id: str, timeout: int = 600) -> str:
        """ç­‰å¾…ä»»åŠ¡å®Œæˆ"""
        start_time = time.time()
        while time.time() - start_time < timeout:
            result = self.check_task(task_id)
            status = result.get("task_status")
            
            if status == "SUCCESS":
                return result["video_result"][0]["url"]
            elif status in ["FAIL", "FAILED"]:
                raise Exception(f"ä»»åŠ¡å¤±è´¥: {result}")
            
            time.sleep(10)
        
        raise TimeoutError("ä»»åŠ¡è¶…æ—¶")
    
    def generate(self, prompt: str, image_url: str = None) -> str:
        """ç”Ÿæˆè§†é¢‘ï¼ˆå®Œæ•´æµç¨‹ï¼‰"""
        task_id = self.submit_task(prompt, image_url)
        return self.wait_for_completion(task_id)
    
    def generate_batch(
        self,
        prompts: List[str],
        max_workers: int = 3
    ) -> List[Dict]:
        """æ‰¹é‡ç”Ÿæˆè§†é¢‘"""
        results = []
        
        with concurrent.futures.ThreadPoolExecutor(max_workers=max_workers) as executor:
            futures = {
                executor.submit(self.generate, prompt): i
                for i, prompt in enumerate(prompts)
            }
            
            for future in concurrent.futures.as_completed(futures):
                i = futures[future]
                try:
                    video_url = future.result()
                    results.append({
                        "index": i,
                        "prompt": prompts[i],
                        "status": "success",
                        "url": video_url
                    })
                except Exception as e:
                    results.append({
                        "index": i,
                        "prompt": prompts[i],
                        "status": "failed",
                        "error": str(e)
                    })
        
        return sorted(results, key=lambda x: x["index"])

# ä½¿ç”¨ç¤ºä¾‹
generator = VideoGenerator(api_key="your-api-key")

# å•ä¸ªç”Ÿæˆ
video_url = generator.generate("çŒ«å’ªåœ¨å¼¹é’¢ç´")

# æ‰¹é‡ç”Ÿæˆ
results = generator.generate_batch([
    "æµ·æµªæ‹æ‰“ç¤çŸ³",
    "æ¨±èŠ±é£˜è½çš„è¡—é“",
    "çƒŸèŠ±ç»½æ”¾çš„å¤œç©º"
])
```

### ä»»åŠ¡çŠ¶æ€è¯´æ˜

| çŠ¶æ€ | è¯´æ˜ |
|:---|:---|
| `PENDING` | ä»»åŠ¡ç­‰å¾…ä¸­ï¼Œå°šæœªå¼€å§‹å¤„ç† |
| `PROCESSING` | ä»»åŠ¡å¤„ç†ä¸­ |
| `SUCCESS` | ä»»åŠ¡æˆåŠŸå®Œæˆï¼Œå¯ä»¥è·å–è§†é¢‘ URL |
| `FAIL` / `FAILED` | ä»»åŠ¡å¤±è´¥ |

### æç¤ºè¯æŠ€å·§

#### æœ‰æ•ˆçš„è§†é¢‘æç¤ºè¯ç»“æ„

```
[ä¸»ä½“] + [åŠ¨ä½œ/è¿åŠ¨] + [åœºæ™¯/ç¯å¢ƒ] + [å…‰çº¿/æ°›å›´] + [é£æ ¼/ç”»è´¨]
```

#### ç¤ºä¾‹æç¤ºè¯

```python
video_prompts = [
    # è‡ªç„¶é£å…‰
    "ç€‘å¸ƒä»é«˜å¤„å€¾æ³»è€Œä¸‹ï¼Œæ°´é›¾å¼¥æ¼«ï¼Œé˜³å…‰ç©¿é€å½¢æˆå½©è™¹ï¼Œ4Ké«˜æ¸…",
    
    # åŠ¨ç‰©
    "ä¸€ç¾¤æµ·è±šåœ¨æµ·é¢ä¸Šè·ƒå‡ºæ°´é¢ï¼Œè“å¤©ç¢§æµ·èƒŒæ™¯ï¼Œæ…¢åŠ¨ä½œ",
    
    # åŸå¸‚
    "åŸå¸‚è¡—é“å¤œæ™¯ï¼Œéœ“è™¹ç¯é—ªçƒï¼Œé›¨æ°´åå°„è·¯é¢ç¯å…‰ï¼Œèµ›åšæœ‹å…‹é£æ ¼",
    
    # æŠ½è±¡
    "å½©è‰²å¢¨æ°´åœ¨æ°´ä¸­æ‰©æ•£ï¼Œå½¢æˆæµåŠ¨çš„å›¾æ¡ˆï¼Œå¾®è§‚æ‘„å½±",
    
    # äººç‰©
    "ä¸€ä½èˆè€…åœ¨èˆå°ä¸Šæ—‹è½¬ï¼Œèšå…‰ç¯è·Ÿéšï¼Œä¼˜é›…çš„èˆå§¿"
]
```

### å‚æ•°è¯´æ˜

| å‚æ•° | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|:---|:---|:---:|:---|
| model | string | æ˜¯ | `cogvideox-flash` |
| prompt | string | æ˜¯ | è§†é¢‘ç”Ÿæˆæç¤ºè¯ |
| image_url | string | å¦ | é¦–å¸§å›¾ç‰‡ URLï¼ˆå›¾ç”Ÿè§†é¢‘æ—¶æä¾›ï¼‰ |

### æ³¨æ„äº‹é¡¹

1. **å¼‚æ­¥æ¨¡å¼**ï¼šè§†é¢‘ç”Ÿæˆé‡‡ç”¨å¼‚æ­¥ APIï¼Œéœ€è¦è½®è¯¢æŸ¥è¯¢ä»»åŠ¡çŠ¶æ€
2. **ç”Ÿæˆæ—¶é—´**ï¼šé€šå¸¸éœ€è¦ 1-5 åˆ†é’Ÿï¼Œå¤æ‚åœºæ™¯å¯èƒ½æ›´é•¿
3. **å…è´¹é¢åº¦**ï¼šå®Œå…¨å…è´¹è°ƒç”¨ï¼Œä½†å»ºè®®åˆç†æ§åˆ¶è¯·æ±‚é¢‘ç‡
4. **æç¤ºè¯è´¨é‡**ï¼šè¯¦ç»†çš„è¿åŠ¨æè¿°æœ‰åŠ©äºç”Ÿæˆæ›´å¥½çš„è§†é¢‘
5. **è§†é¢‘æ ¼å¼**ï¼šç”Ÿæˆçš„è§†é¢‘ä¸º MP4 æ ¼å¼
6. **è§†é¢‘æœ‰æ•ˆæœŸ**ï¼šç”Ÿæˆçš„è§†é¢‘ URL é€šå¸¸æœ‰æœ‰æ•ˆæœŸï¼Œå»ºè®®åŠæ—¶ä¸‹è½½ä¿å­˜
7. **å¹¶å‘æ§åˆ¶**ï¼šå»ºè®®é€‚å½“æ§åˆ¶å¹¶å‘æ•°é‡ï¼Œé¿å…è¿‡å¤šä»»åŠ¡åŒæ—¶æäº¤

### ä¸ CogVideoX çš„åŒºåˆ«

| ç‰¹æ€§ | CogVideoX | CogVideoX-Flash |
|:---|:---:|:---:|
| è´¹ç”¨ | æ”¶è´¹ | **å…è´¹** |
| ç”Ÿæˆè´¨é‡ | æ›´é«˜ | è‰¯å¥½ |
| ç”Ÿæˆé€Ÿåº¦ | æ­£å¸¸ | è¾ƒå¿« |
| é€‚ç”¨åœºæ™¯ | å•†ä¸šç”Ÿäº§ | å¿«é€ŸåŸå‹ã€ä¸ªäººåˆ›ä½œ |

### å®Œæ•´ä½¿ç”¨æµç¨‹

```python
# 1. åˆå§‹åŒ–å®¢æˆ·ç«¯
client = OpenAI(
    api_key="your-api-key",
    base_url="https://open.bigmodel.cn/api/paas/v4"
)

# 2. å‡†å¤‡æç¤ºè¯
prompt = "æè¿°ä½ æƒ³è¦çš„è§†é¢‘åœºæ™¯"

# 3. æäº¤ä»»åŠ¡
response = client.post(
    path="videos/generations",
    cast_to=dict,
    body={"model": "cogvideox-flash", "prompt": prompt}
)
task_id = response["id"]

# 4. è½®è¯¢ç­‰å¾…
while True:
    result = client.get(
        path=f"async-result/{task_id}",
        cast_to=dict
    )
    if result["task_status"] == "SUCCESS":
        video_url = result["video_result"][0]["url"]
        break
    time.sleep(10)

# 5. ä½¿ç”¨è§†é¢‘
print(f"è§†é¢‘å·²ç”Ÿæˆ: {video_url}")
```
