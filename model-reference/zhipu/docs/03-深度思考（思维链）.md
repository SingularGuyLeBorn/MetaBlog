# 03-深度思考（思维链）

## GLM-4.1V-Thinking-Flash 模型

### 模型概述

GLM-4.1V-Thinking-Flash 是面向 **视觉推理场景** 优化的高阶模型，专为复杂视觉理解、深度逻辑分析和链式推理任务设计。它继承了 GLM-4.1V 系列的**深度思考能力**，并将其拓展至视觉领域，实现 "看见即思考，思考即解答" 的智能闭环。

### 模型规格

| 规格项 | 数值 |
|:---|:---|
| 输入模态 | 视频、图像、文本 |
| 输出模态 | 文本 |
| 上下文窗口 | 64K tokens |
| 最大输出 Tokens | 16K |
| 图片数量限制 | 最多 50 张 |
| 思考模式 | ✅ 强制开启 |
| 思维链 | ✅ 强制返回 |

### 核心特点

#### 🧠 深度思考能力（内置）

相比 4.6V-Flash 的可选思考模式，GLM-4.1V-Thinking-Flash 的**思考能力已内置**，无需额外参数开启，每次输出均附带完整的思维链过程。

#### 🖼️ 视觉推理闭环

在视觉理解的基础上叠加深度推理能力：
- 精准识别视觉元素（物体、文字、图表）
- 结合文本指令进行多步逻辑推演
- 执行复杂的任务流

### 能力支持

- ✅ **深度思考** - 思考能力已内置，无需额外参数
- ✅ **视觉理解** - 强大的视觉理解能力
- ✅ **流式输出** - 支持实时流式响应
- ✅ **上下文缓存** - 智能缓存机制

### ⚠️ 重要限制

- **不支持 Function Call** - 该模型专注于推理能力，不开放工具调用接口
- **不支持同时理解文件、视频和图像** - 每次调用只能选择一种多模态类型
- **思考无法关闭** - 无法通过参数关闭思考能力

### 适用场景

#### 典型应用场景

| 场景类型 | 示例 |
|:---|:---|
| **理科题目解答** | 图像化数学题、物理电路图、化学方程式 |
| **阅读图表数据** | 财务报表分析、销售趋势图、科研数据图表 |
| **理解流程图** | 业务逻辑图、技术架构图、算法流程图 |
| **视觉问答** | 复杂场景分析、多步骤逻辑推导 |
| **GUI Agent 任务** | 理解界面并生成操作序列 |

### API 调用方式

**端点**：`https://open.bigmodel.cn/api/paas/v4/chat/completions`

### 基础调用示例

```bash
curl -X POST \
https://open.bigmodel.cn/api/paas/v4/chat/completions \
-H "Authorization: Bearer your-api-key" \
-H "Content-Type: application/json" \
-d '{
  "model": "glm-4.1v-thinking-flash",
  "messages": [
    {
      "role": "user",
      "content": [
        {
          "type": "image_url",
          "image_url": {
            "url": "https://example.com/chart.png"
          }
        },
        {
          "type": "text",
          "text": "分析这个图表，找出销售额最高的季度"
        }
      ]
    }
  ]
}'
```

### Python 调用示例

```python
from openai import OpenAI

client = OpenAI(
    api_key="your-api-key",
    base_url="https://open.bigmodel.cn/api/paas/v4"
)

# 图表分析 - 自动深度思考
response = client.chat.completions.create(
    model="glm-4.1v-thinking-flash",
    messages=[
        {
            "role": "user",
            "content": [
                {
                    "type": "image_url",
                    "image_url": {"url": "https://example.com/chart.png"}
                },
                {
                    "type": "text",
                    "text": "分析这个柱状图，找出销售额最高的月份并说明原因"
                }
            ]
        }
    ]
)

# 获取思维链和最终答案
message = response.choices[0].message
print("推理过程：")
print(message.reasoning_content)
print("\n最终答案：")
print(message.content)
```

### 数学题解答示例

```python
# 解决数学问题 - 展示推理过程
response = client.chat.completions.create(
    model="glm-4.1v-thinking-flash",
    messages=[
        {
            "role": "user",
            "content": [
                {
                    "type": "image_url",
                    "image_url": {"url": "https://example.com/math_problem.png"}
                },
                {
                    "type": "text",
                    "text": "请解答这道数学题，展示完整的解题步骤"
                }
            ]
        }
    ]
)

print("思考过程：")
print(response.choices[0].message.reasoning_content)
print("\n答案：")
print(response.choices[0].message.content)
```

### GUI Agent 示例

```python
# 根据 UI 截图生成操作序列
response = client.chat.completions.create(
    model="glm-4.1v-thinking-flash",
    messages=[
        {
            "role": "user",
            "content": [
                {
                    "type": "image_url",
                    "image_url": {"url": "https://example.com/webpage_screenshot.png"}
                },
                {
                    "type": "text",
                    "text": """分析这个网页界面，按步骤描述如何完成以下任务：
1. 找到登录入口
2. 输入用户名和密码
3. 点击登录按钮"""
                }
            ]
        }
    ]
)

print("界面分析：")
print(response.choices[0].message.reasoning_content)
print("\n操作步骤：")
print(response.choices[0].message.content)
```

### 流式输出（带思考）

```python
# 流式输出时，reasoning_content 和 content 会分别流式传输
response = client.chat.completions.create(
    model="glm-4.1v-thinking-flash",
    messages=[
        {
            "role": "user",
            "content": [
                {
                    "type": "image_url",
                    "image_url": {"url": "https://example.com/data.png"}
                },
                {
                    "type": "text",
                    "text": "分析这个数据表"
                }
            ]
        }
    ],
    stream=True
)

print("推理过程：")
for chunk in response:
    delta = chunk.choices[0].delta
    if hasattr(delta, 'reasoning_content') and delta.reasoning_content:
        print(delta.reasoning_content, end="", flush=True)

print("\n\n最终答案：")
for chunk in response:
    delta = chunk.choices[0].delta
    if delta.content:
        print(delta.content, end="", flush=True)
```

### 参数说明

| 参数 | 类型 | 必填 | 说明 |
|:---|:---|:---:|:---|
| model | string | 是 | `glm-4.1v-thinking-flash` |
| messages | array | 是 | 对话消息列表（支持图片/视频/文本） |
| max_tokens | integer | 否 | 最大输出 tokens |
| temperature | float | 否 | 采样温度 |
| stream | boolean | 否 | 是否流式输出 |

> **注意**：该模型不支持 `thinking` 参数，思考能力已内置且强制开启

### 注意事项

1. **强制思考**：每次响应都会返回 `reasoning_content`（思维链），无法关闭
2. **不支持工具调用**：专注于视觉推理，不提供 Function Call 能力
3. **多模态限制**：不能同时处理文件、视频和图像，需分别调用
4. **适用场景**：适合需要深度分析、多步推理的视觉任务
5. **响应延迟**：由于需要完整推理，响应时间会比普通模型稍长

### 与其他视觉模型的对比

| 能力 | GLM-4.1V-Thinking-Flash | GLM-4.6V-Flash | GLM-4V-Flash |
|:---|:---:|:---:|:---:|
| 思考模式 | ✅ **强制** | ✅ 可选 | ❌ |
| 推理深度 | ⭐⭐⭐⭐⭐ | ⭐⭐⭐☆☆ | ⭐⭐☆☆☆ |
| Function Call | ❌ | ✅ | ❌ |
| 图片数量 | 50 张 | 50 张 | 1 张 |
| 上下文 | 64K | 128K | 16K |
| 最大输出 | 16K | 32K | 1K |
