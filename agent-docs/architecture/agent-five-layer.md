# Agent äº”å±‚æ¶æ„è¯¦è§£

> **ã€æ€»-åˆ†-æ€»ã€‘MetaUniverse Agent äº”å±‚æ¶æ„**
> 
> è¯¦ç»†æè¿° L1-L5 æ¯å±‚çš„è®¾è®¡åŸç†ã€ç»„ä»¶æ„æˆå’Œå±‚é—´äº¤äº’ã€‚

---

## ã€æ€»ã€‘æ¶æ„å…¨æ™¯

MetaUniverse Agent é‡‡ç”¨**äº”å±‚åˆ†å±‚æ¶æ„**ï¼Œä»ä¸‹è‡³ä¸Šä¾æ¬¡ä¸ºï¼šè®°å¿†å­˜å‚¨å±‚ã€è¿è¡Œæ—¶ä¸è§‚å¯Ÿå±‚ã€å·¥å…·ä¸æ„ŸçŸ¥å±‚ã€æ™ºèƒ½ç¼–æ’å±‚ã€äººæœºå…±ç”Ÿç•Œé¢å±‚ã€‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     L5: äººæœºå…±ç”Ÿç•Œé¢å±‚ (Human-AI Interface)              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ BlogFrontend â”‚ â”‚   GlobalPage â”‚ â”‚  AIChatOrb   â”‚ â”‚  Knowledge   â”‚  â”‚
â”‚  â”‚  (ä¿ç•™Vite   â”‚ â”‚   Editor-AGI â”‚ â”‚  (æ™ºèƒ½å…¥å£)   â”‚ â”‚   Graph      â”‚  â”‚
â”‚  â”‚   Pressæ ¸å¿ƒ) â”‚ â”‚  (ä¸‰æ¨¡æ€ç¼–è¾‘) â”‚ â”‚   æ‚¬æµ®çƒ)    â”‚ â”‚ (AIæ¢ç´¢)     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                     L4: æ™ºèƒ½ç¼–æ’å±‚ (AI Orchestration)                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ IntentRouter â”‚ â”‚   Skill      â”‚ â”‚   State      â”‚ â”‚  Memory      â”‚  â”‚
â”‚  â”‚ (æ„å›¾è§£æ)    â”‚ â”‚   Engine     â”‚ â”‚   Machine    â”‚ â”‚  Manager     â”‚  â”‚
â”‚  â”‚              â”‚ â”‚ (æŠ€èƒ½æ‰§è¡Œ)   â”‚ â”‚ (æ–­ç‚¹ç»­ä½œ)    â”‚ â”‚ (æ–‡ä»¶åŒ–è®°å¿†)  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                     L3: å·¥å…·ä¸æ„ŸçŸ¥å±‚ (Tools & Senses)                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   WebSearch  â”‚ â”‚   Vditor     â”‚ â”‚    Git       â”‚ â”‚   RAG        â”‚  â”‚
â”‚  â”‚   (ç½‘ç»œæœç´¢) â”‚ â”‚   Bridge     â”‚ â”‚  Operator    â”‚ â”‚   Engine     â”‚  â”‚
â”‚  â”‚              â”‚ â”‚ (ç¼–è¾‘å™¨é›†æˆ) â”‚ â”‚ (Gitæ“ä½œ)    â”‚ â”‚ (å‘é‡æ£€ç´¢)   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                     L2: è¿è¡Œæ—¶ä¸è§‚å¯Ÿå±‚ (Runtime & Observability)        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   LLM        â”‚ â”‚   Logger     â”‚ â”‚   Cost       â”‚ â”‚   Health     â”‚  â”‚
â”‚  â”‚  Manager     â”‚ â”‚ (ç»“æ„åŒ–æ—¥å¿—) â”‚ â”‚   Tracker    â”‚ â”‚   Checker    â”‚  â”‚
â”‚  â”‚ (å¤šæä¾›å•†)   â”‚ â”‚              â”‚ â”‚ (Tokenè®¡è´¹)  â”‚ â”‚ (æ•…éšœè‡ªæ„ˆ)   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                     L1: è®°å¿†å­˜å‚¨å±‚ (Memory Storage)                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   Content    â”‚ â”‚   History    â”‚ â”‚   Agent      â”‚ â”‚   Vector     â”‚  â”‚
â”‚  â”‚   Repo       â”‚ â”‚   Backups    â”‚ â”‚   States     â”‚ â”‚   DB         â”‚  â”‚
â”‚  â”‚ (Gitç‰ˆæœ¬)    â”‚ â”‚ (æ“ä½œå†å²)   â”‚ â”‚ (ä»»åŠ¡çŠ¶æ€)   â”‚ â”‚ (RAGç´¢å¼•)    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ¶æ„è®¾è®¡åŸåˆ™

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    æ¶æ„è®¾è®¡äº”åŸåˆ™                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  1. å±‚é—´å•å‘ä¾èµ–                                                 â”‚
â”‚     â€¢ ä¸Šå±‚å¯è°ƒç”¨ä¸‹å±‚ï¼Œä¸‹å±‚ä¸å¯æ„ŸçŸ¥ä¸Šå±‚                            â”‚
â”‚     â€¢ é€šè¿‡æ¥å£å¥‘çº¦äº¤äº’                                           â”‚
â”‚                                                                 â”‚
â”‚  2. èŒè´£å•ä¸€                                                     â”‚
â”‚     â€¢ æ¯å±‚æœ‰æ˜ç¡®ä¸”å”¯ä¸€çš„èŒè´£                                     â”‚
â”‚     â€¢ ç»„ä»¶å†…èšï¼Œå±‚é—´æ¾è€¦åˆ                                       â”‚
â”‚                                                                 â”‚
â”‚  3. å¯æ›¿æ¢æ€§                                                     â”‚
â”‚     â€¢ å±‚å†…ç»„ä»¶å¯æ›¿æ¢ï¼Œä¸å½±å“å…¶ä»–å±‚                                â”‚
â”‚     â€¢ æ”¯æŒå¤šç§å®ç°ï¼ˆå¦‚å¤šç§ LLM æä¾›å•†ï¼‰                           â”‚
â”‚                                                                 â”‚
â”‚  4. æ¸è¿›å¢å¼º                                                     â”‚
â”‚     â€¢ æ ¸å¿ƒåŠŸèƒ½è½»é‡ï¼Œé«˜çº§åŠŸèƒ½å¯æ’æ‹”                                â”‚
â”‚     â€¢ MANUAL æ¨¡å¼ä¸‹æ—  AI ä»‹å…¥                                    â”‚
â”‚                                                                 â”‚
â”‚  5. å¯è§‚æµ‹æ€§                                                     â”‚
â”‚     â€¢ æ‰€æœ‰æ“ä½œå¯è¿½è¸ªã€å¯åº¦é‡                                     â”‚
â”‚     â€¢ Token ä½¿ç”¨ã€æˆæœ¬ã€è€—æ—¶é€æ˜                                 â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ã€åˆ†ã€‘åˆ†å±‚è¯¦è§£

### L1: è®°å¿†å­˜å‚¨å±‚ (Memory Storage)

**ã€æ€»ã€‘èŒè´£æ¦‚è¿°**

å­˜å‚¨å±‚è´Ÿè´£æ‰€æœ‰æ•°æ®çš„æŒä¹…åŒ–ï¼Œæ˜¯ç³»ç»Ÿçš„"è®°å¿†ä¸­æ¢"ã€‚åŒ…æ‹¬å†…å®¹ç‰ˆæœ¬ã€æ“ä½œå†å²ã€ä»»åŠ¡çŠ¶æ€ã€å‘é‡ç´¢å¼•ã€‚

**ã€åˆ†ã€‘å­˜å‚¨ç»“æ„**

```
docs/.vitepress/
â”œâ”€â”€ memory/                        # L1: Agent è®°å¿†ï¼ˆGit è·Ÿè¸ªï¼‰
â”‚   â”œâ”€â”€ entities/                  # å®ä½“åº“
â”‚   â”‚   â”œâ”€â”€ concepts.json          # æ¦‚å¿µå®šä¹‰
â”‚   â”‚   â”œâ”€â”€ technologies.json      # æŠ€æœ¯/æ¡†æ¶
â”‚   â”‚   â”œâ”€â”€ papers.json            # è®ºæ–‡
â”‚   â”‚   â”œâ”€â”€ people.json            # äººå
â”‚   â”‚   â””â”€â”€ code.json              # ä»£ç /ç®—æ³•
â”‚   â”œâ”€â”€ tasks/                     # ä»»åŠ¡å†å²
â”‚   â”‚   â””â”€â”€ task_xxx.json
â”‚   â”œâ”€â”€ context/                   # çŸ­æœŸä¼šè¯è®°å¿†
â”‚   â”‚   â””â”€â”€ sess_xxx.json
â”‚   â””â”€â”€ skills/                    # æŠ€èƒ½æç¤ºè¯æ¨¡æ¿
â”‚       â””â”€â”€ research.yaml
â”‚
â”œâ”€â”€ history/                       # L1: ç¼–è¾‘å†å²ï¼ˆåŸæœ‰ï¼‰
â”‚   â”œâ”€â”€ posts/                     # æ–‡ä»¶çº§å†å²
â”‚   â””â”€â”€ agent/                     # Agent æ“ä½œå†å²ï¼ˆæ–°å¢ï¼‰
â”‚
â””â”€â”€ cache/                         # L1: æ„å»ºç¼“å­˜ï¼ˆ.gitignoreï¼‰
    â””â”€â”€ rag/
        â””â”€â”€ index.bin              # å‘é‡ç´¢å¼•
```

**ã€åˆ†ã€‘å­˜å‚¨ç»„ä»¶**

| ç»„ä»¶ | æŠ€æœ¯é€‰å‹ | å­˜å‚¨å†…å®¹ | æ¼”è¿›è·¯çº¿ |
|------|---------|---------|---------|
| Content Repo | Git | Markdown æ–‡ç« ã€ä»£ç æ–‡ä»¶ | åŸæœ‰ï¼Œä¿æŒä¸å˜ |
| History Backups | localStorage â†’ æ–‡ä»¶ | ç¼–è¾‘å†å²ã€ä»»åŠ¡è®°å½• | Phase 1 è¿ç§» |
| Agent States | localStorage â†’ æ–‡ä»¶ | æ£€æŸ¥ç‚¹ã€ä¼šè¯çŠ¶æ€ | Phase 1 è¿ç§» |
| Vector DB | å†…å­˜ â†’ IndexedDB â†’ æ–‡ä»¶ | RAG å‘é‡ç´¢å¼• | Phase 1 å®ç° |

**ã€æ€»ã€‘å‘ä¸Šå±‚æš´éœ²çš„æ¥å£**

```typescript
interface StorageLayer {
  // å†…å®¹æ“ä½œ
  readFile(path: string): Promise<string>
  saveFile(path: string, content: string): Promise<void>
  
  // å†å²æ“ä½œ
  saveTaskHistory(history: TaskHistory): Promise<void>
  getTaskHistory(taskId: string): Promise<TaskHistory | null>
  listTaskHistories(limit?: number): Promise<TaskHistory[]>
  
  // å®ä½“æ“ä½œ
  saveEntity(entity: KnowledgeEntity): Promise<void>
  getEntity(id: string): Promise<KnowledgeEntity | null>
  findEntitiesByType(type: EntityType): Promise<KnowledgeEntity[]>
  findEntitiesByName(name: string): Promise<KnowledgeEntity[]>
  
  // å‘é‡æ“ä½œ
  addToVectorIndex(content: string, embedding: number[], metadata?: any): Promise<void>
  vectorSearch(query: number[], topK?: number): Promise<VectorSearchResult[]>
}
```

---

### L2: è¿è¡Œæ—¶ä¸è§‚å¯Ÿå±‚ (Runtime & Observability)

**ã€æ€»ã€‘èŒè´£æ¦‚è¿°**

è¿è¡Œæ—¶å±‚æä¾›åŸºç¡€è®¾æ–½æœåŠ¡ï¼Œæ˜¯ç³»ç»Ÿçš„"ç¥ç»ç³»ç»Ÿ"ã€‚

**ã€åˆ†ã€‘æ ¸å¿ƒç»„ä»¶è¯¦è§£**

#### LLM Manager

```typescript
// ç»Ÿä¸€çš„å¤šæä¾›å•†æ¥å£
class LLMManager {
  private providers: Map<string, LLMProvider>
  private defaultProvider: string
  
  // é…ç½®ç®¡ç†
  configure(provider: string, config: ProviderConfig): void
  setDefaultProvider(provider: string): void
  
  // åŸºç¡€è°ƒç”¨
  chat(request: LLMRequest): Promise<LLMResponse>
  
  // æµå¼è°ƒç”¨ï¼ˆç”¨äºå®æ—¶å±•ç¤ºï¼‰
  chatStream(
    request: LLMRequest, 
    onChunk: (chunk: LLMStreamChunk) => void
  ): Promise<void>
  
  // æˆæœ¬ä¼°ç®—
  estimateCost(model: string, tokens: number): number
  
  // è·å–å¯ç”¨æ¨¡å‹åˆ—è¡¨
  listAvailableModels(): ModelInfo[]
}

// æ”¯æŒçš„æä¾›å•†
const SUPPORTED_PROVIDERS = [
  'deepseek',   // å¸¦ reasoning_content
  'openai',
  'anthropic',
  'gemini',
  'kimi',
  'qwen',
  'zhipu'
]
```

#### Logger

```typescript
// ç»“æ„åŒ–æ—¥å¿—ç³»ç»Ÿ
interface Logger {
  debug(event: string, data?: object): void
  info(event: string, data?: object): void
  warn(event: string, data?: object): void
  error(event: string, data?: object): void
}

// æ—¥å¿—æ ¼å¼ç¤ºä¾‹
{
  "timestamp": "2026-02-18T01:12:09.644Z",
  "level": "info",
  "event": "skill.executed",
  "data": {
    "skill": "WriteArticle",
    "taskId": "task_123",
    "duration": 5200,
    "tokens": 2450,
    "cost": 0.08
  },
  "sessionId": "sess_abc123",
  "traceId": "trace_xyz789"
}
```

#### Cost Tracker

```typescript
// Token ä¸æˆæœ¬è¿½è¸ª
interface CostTracker {
  // è®°å½•ä½¿ç”¨
  record(usage: TokenUsage): void
  
  // ç»Ÿè®¡æŸ¥è¯¢
  getSessionCost(sessionId: string): CostReport
  getTotalCost(): CostReport
  
  // æ ¼å¼åŒ–
  formatTokens(tokens: number): string  // "2.4k"
  formatCost(cost: number): string      // "$0.08"
}

interface TokenUsage {
  timestamp: number
  model: string
  tokens: number
  cost: number
  taskId: string
  skill: string
}
```

**ã€æ€»ã€‘å±‚é—´è°ƒç”¨å…³ç³»**

L2 ä¸º L3/L4 æä¾›åŸºç¡€è®¾æ–½æœåŠ¡ï¼Œé€šè¿‡ä¾èµ–æ³¨å…¥æˆ–å…¨å±€å•ä¾‹è®¿é—®ã€‚

---

### L3: å·¥å…·ä¸æ„ŸçŸ¥å±‚ (Tools & Senses)

**ã€æ€»ã€‘èŒè´£æ¦‚è¿°**

å·¥å…·å±‚å°è£…å¤–éƒ¨æœåŠ¡çš„äº¤äº’ï¼Œæ˜¯ç³»ç»Ÿçš„"æ‰‹è„šå’Œæ„Ÿå®˜"ã€‚

**ã€åˆ†ã€‘å·¥å…·è¯¦è§£**

#### WebSearch

```typescript
interface WebSearchTool {
  // å¤šæºæœç´¢
  search(query: string, options: SearchOptions): Promise<SearchResult[]>
  
  // ç‰¹å®šç«™ç‚¹æœç´¢
  searchArxiv(query: string): Promise<Paper[]>
  searchGoogle(query: string): Promise<SearchResult[]>
  searchGitHub(query: string): Promise<Repo[]>
  
  // ç»“æœå¯ä¿¡åº¦è¯„åˆ†
  scoreCredibility(result: SearchResult): number
  
  // æŠ“å–ç½‘é¡µå†…å®¹
  fetchContent(url: string): Promise<string>
}

interface SearchResult {
  title: string
  link: string
  snippet: string
  source: 'google' | 'arxiv' | 'github' | 'other'
  credibility: number  // 0-1
  publishedDate?: string
}
```

**å®ç°çŠ¶æ€**: ğŸŸ¡ Phase 1 æ¥å…¥ SerpAPI

#### Vditor Bridge

```typescript
interface VditorBridge {
  // ç¼–è¾‘å™¨çŠ¶æ€
  getContent(): string
  setContent(content: string): void
  getSelection(): { text: string; range: Range }
  getCursorPosition(): { line: number; ch: number }
  
  // åä½œåŠŸèƒ½
  insertSuggestion(suggestion: Suggestion): void
  showInlineHint(hint: string, position: Position): void
  highlightText(range: Range, className: string): void
  
  // äº‹ä»¶ç›‘å¬
  onChange(callback: (content: string) => void): void
  onSave(callback: () => void): void
  onSelectionChange(callback: () => void): void
}
```

#### Git Operator

```typescript
interface GitOperator {
  // åŸºæœ¬æ“ä½œ
  commit(options: CommitOptions): Promise<CommitResult>
  diff(from: string, to: string): Promise<DiffResult>
  log(options: LogOptions): Promise<CommitInfo[]>
  status(): Promise<StatusResult>
  
  // åˆ†æ”¯æ“ä½œ
  branch(name: string): Promise<void>
  checkout(ref: string): Promise<void>
  
  // Agent ä¸“ç”¨
  commitAsAgent(params: AgentCommitParams): Promise<CommitResult>
  revertToCheckpoint(checkpointId: string): Promise<void>
  createCheckpoint(name: string): Promise<string>
}

interface AgentCommitParams {
  path: string
  taskId: string
  message: string
  metadata: {
    model: string
    tokens: number
    cost: number
    skill: string
  }
}
```

**å®ç°çŠ¶æ€**: ğŸŸ¡ Phase 2 å®Œæ•´å®ç°

#### RAG Engine

```typescript
interface RAGEngine {
  // ç´¢å¼•æ„å»º
  indexDocument(path: string, content: string): Promise<void>
  buildIndex(): Promise<void>
  
  // æ£€ç´¢
  search(query: string, options: SearchOptions): Promise<RAGResult[]>
  hybridSearch(query: string): Promise<RAGResult[]>  // å…³é”®è¯ + å‘é‡
  
  // ä¸Šä¸‹æ–‡æ„å»º
  buildContext(query: string, currentFile?: string): Promise<ContextChunk[]>
}

interface RAGResult {
  content: string
  source: string
  score: number
  metadata: {
    type: 'entity' | 'task_history' | 'article' | 'external'
    entityType?: EntityType
    title?: string
  }
}
```

**å®ç°çŠ¶æ€**: ğŸŸ¡ Phase 1 å®ç°å‘é‡æ£€ç´¢

---

### L4: æ™ºèƒ½ç¼–æ’å±‚ (AI Orchestration)

**ã€æ€»ã€‘èŒè´£æ¦‚è¿°**

ç¼–æ’å±‚æ˜¯ç³»ç»Ÿçš„"å¤§è„‘"ï¼Œè´Ÿè´£ç†è§£æ„å›¾ã€è°ƒåº¦æŠ€èƒ½ã€ç®¡ç†çŠ¶æ€ã€ç»´æŠ¤è®°å¿†ã€‚

**ã€åˆ†ã€‘æ ¸å¿ƒç»„ä»¶è¯¦è§£**

#### IntentRouter

```typescript
class IntentRouter {
  private skills: Map<string, Skill>
  
  // æŠ€èƒ½æ³¨å†Œ
  registerSkill(skill: Skill): void
  
  // æ„å›¾è§£æ
  parse(input: string, context?: object): Promise<ParsedIntent>
  
  // æŠ€èƒ½åŒ¹é…
  findSkill(intent: ParsedIntent): Skill | null
  
  // ç›¸ä¼¼æ„å›¾æ¨è
  getSimilarIntents(intent: ParsedIntent, limit: number): ScoredIntent[]
}

interface ParsedIntent {
  type: string
  params: object
  confidence: number
  skill?: string
  raw: string
}
```

#### SkillEngine

```typescript
class SkillEngine {
  private skills: Map<string, Skill>
  
  // æŠ€èƒ½ç®¡ç†
  register(skill: Skill): void
  registerMany(skills: Skill[]): void
  getSkill(name: string): Skill | undefined
  
  // æŠ€èƒ½æ‰§è¡Œ
  execute(
    skillName: string, 
    context: SkillContext, 
    params: object
  ): Promise<SkillResult>
  
  // å…ƒæ•°æ®
  listSkills(): SkillInfo[]
}

interface Skill {
  name: string
  description: string
  intentPattern: RegExp
  requiredParams: string[]
  optionalParams: string[]
  handler: (ctx: SkillContext, params: object) => Promise<SkillResult>
}
```

#### StateMachine

```typescript
class StateMachine {
  private currentState: AgentState
  private listeners: Map<AgentState, Set<Callback>>
  
  // çŠ¶æ€å®šä¹‰
  states: ['IDLE', 'UNDERSTANDING', 'PLANNING', 'EXECUTING', 'PAUSED', 'COMPLETED', 'ERROR']
  
  // çŠ¶æ€è½¬æ¢
  transition(to: AgentState): void
  canTransition(from: AgentState, to: AgentState): boolean
  
  // äº‹ä»¶ç›‘å¬
  on(state: AgentState, callback: Callback): void
  
  // æ–­ç‚¹ç»­ä½œ
  saveCheckpoint(): Promise<Checkpoint>
  loadCheckpoint(id: string): Promise<void>
}

type AgentState = 
  | 'IDLE'           // ç©ºé—²
  | 'UNDERSTANDING'  // ç†è§£æ„å›¾
  | 'PLANNING'       // è§„åˆ’ä»»åŠ¡
  | 'EXECUTING'      // æ‰§è¡Œä¸­
  | 'PAUSED'         // æš‚åœï¼ˆç­‰å¾…ç”¨æˆ·ï¼‰
  | 'COMPLETED'      // å®Œæˆ
  | 'ERROR'          // é”™è¯¯
```

**çŠ¶æ€æµè½¬å›¾**ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”   æ”¶åˆ°è¾“å…¥   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   è§£ææˆåŠŸ   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ IDLE â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ â”‚ UNDERSTANDINGâ”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ â”‚ PLANNING â”‚
â””â”€â”€â”€â”€â”€â”€â”˜             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
   â†‘                                                 â”‚
   â”‚                                                 â†“
   â”‚               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   æ‰§è¡Œå®Œæˆ   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚  ERROR  â”‚ â†â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚ EXECUTING â”‚
      é”™è¯¯æ¢å¤      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
                                               â”‚
                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   ç”¨æˆ·æš‚åœ   â”‚
                     â”‚  PAUSED  â”‚ â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
                          â”‚ ç»§ç»­æ‰§è¡Œ
                          â†“
                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                     â”‚ COMPLETEDâ”‚
                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### MemoryManager

è¯¦è§ [ç»„ä»¶è¯¦è§£ - MemoryManager](../components/memory.md)

---

### L5: äººæœºå…±ç”Ÿç•Œé¢å±‚ (Human-AI Interface)

**ã€æ€»ã€‘èŒè´£æ¦‚è¿°**

ç•Œé¢å±‚æ˜¯ç”¨æˆ·ä¸ç³»ç»Ÿäº¤äº’çš„å…¥å£ï¼Œæä¾›ä¸‰ç§ä¸åŒçš„åä½œæ¨¡å¼ã€‚

**ã€åˆ†ã€‘æ ¸å¿ƒç»„ä»¶è¯¦è§£**

#### AIChatOrb

```typescript
// AIChatOrb ç»„ä»¶
interface AIChatOrb {
  // çŠ¶æ€
  isOpen: boolean
  messages: ChatMessage[]
  isStreaming: boolean
  unreadCount: number
  
  // ä¸Šä¸‹æ–‡æ„ŸçŸ¥
  captureContext(): ContextSnapshot
  
  // å¿«æ·æ“ä½œ
  quickActions: QuickAction[]
  
  // äº¤äº’
  open(): void
  close(): void
  sendMessage(message: string): Promise<void>
  clearHistory(): void
}

interface ContextSnapshot {
  currentPage: string      // å½“å‰æ–‡ç« è·¯å¾„
  selectedText: string     // ç”¨æˆ·é€‰ä¸­çš„æ–‡å­—
  wikiLinks: string[]     // å½“å‰æ–‡ç« çš„å†…éƒ¨é“¾æ¥
  recentHistory: string[] // æœ€è¿‘ç›¸å…³æ–‡ç« 
}

type QuickAction = 
  | { type: 'continue'; label: 'ç»­å†™'; icon: 'ğŸ“' }
  | { type: 'search'; label: 'æœç´¢'; icon: 'ğŸ”' }
  | { type: 'summarize'; label: 'æ€»ç»“'; icon: 'ğŸ“Š' }
  | { type: 'explain'; label: 'è§£é‡Š'; icon: 'ğŸ’¡' }
```

#### GlobalPageEditor-AGI

```typescript
// ä¸‰æ¨¡æ€ç¼–è¾‘å™¨
type EditorMode = 'MANUAL' | 'COLLAB' | 'AGENT'

interface GlobalPageEditorAGI {
  // çŠ¶æ€
  mode: EditorMode
  content: string
  isSaving: boolean
  agentState: AgentState
  suggestions: Suggestion[]
  
  // æ¨¡å¼åˆ‡æ¢
  setMode(mode: EditorMode): void
  
  // å†…å®¹æ“ä½œ
  loadContent(path: string): Promise<void>
  saveContent(): Promise<void>
  
  // COLLAB æ¨¡å¼
  analyzeContent(): Promise<void>
  acceptSuggestion(suggestion: Suggestion): void
  dismissSuggestion(suggestion: Suggestion): void
  
  // AGENT æ¨¡å¼
  sendCommand(command: string): Promise<void>
}

const modeConfig: Record<EditorMode, ModeConfig> = {
  MANUAL: {
    label: 'äººå·¥',
    icon: 'ğŸ‘¤',
    color: '#6b7280',
    description: 'å®Œå…¨æ‰‹åŠ¨ç¼–è¾‘',
    features: ['auto-save', 'outline']
  },
  COLLAB: {
    label: 'åä½œ',
    icon: 'ğŸ¤',
    color: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
    description: 'AI å®æ—¶å»ºè®®',
    features: ['inline-suggestion', 'context-indicator', 'entity-detection']
  },
  AGENT: {
    label: 'æ‰˜ç®¡',
    icon: 'ğŸ¤–',
    color: 'linear-gradient(135deg, #11998e 0%, #38ef7d 100%)',
    description: 'Agent è‡ªåŠ¨æ‰§è¡Œ',
    features: ['natural-language-command', 'auto-write', 'auto-edit']
  }
}
```

#### HistoryViewer-AGI

```typescript
// å¢å¼ºå†å²æŸ¥çœ‹å™¨
interface HistoryViewerAGI {
  activeTab: 'file' | 'agent'
  
  // æ–‡ä»¶å†å²
  humanCommits: CommitInfo[]
  agentCommits: CommitInfo[]
  selectedCommit: CommitInfo | null
  
  // Agent ä»»åŠ¡
  agentTasks: TaskHistory[]
  selectedTask: TaskHistory | null
  selectedStep: TaskStep | null
  
  // æ“ä½œ
  loadHistory(): Promise<void>
  viewCommit(commit: CommitInfo): void
  viewTask(task: TaskHistory): void
  viewStep(step: TaskStep): void
  rollback(commitHash: string): Promise<void>
}
```

---

## ã€æ€»ã€‘å±‚é—´åä½œä¸æ•°æ®æµ

### å®Œæ•´æ•°æ®æµ

```
ç”¨æˆ·æ“ä½œ (L5)
    â†“
AIChatOrb / GlobalPageEditor-AGI
    â†“ è°ƒç”¨
AgentRuntime.processInput() (L4)
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ IntentRouter.parse() - æ„å›¾è§£æ     â”‚
â”‚ StateMachine.transition() - çŠ¶æ€ç®¡ç† â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
SkillEngine.execute() (L4)
    â†“ è°ƒç”¨
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ LLM.chat() (L2)                     â”‚
â”‚ WebSearch.search() (L3)             â”‚
â”‚ MemoryManager.buildContext() (L4)   â”‚
â”‚ RAGEngine.vectorSearch() (L3)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
ç»“æœèšåˆ (L4)
    â†“
UI æ›´æ–° (L5)
    â†“
MemoryManager.save*() (L4) â†’ Storage (L1)
```

### è°ƒç”¨å…³ç³»çŸ©é˜µ

| è°ƒç”¨æ–¹ â†“ \ è¢«è°ƒæ–¹ â†’ | L1 å­˜å‚¨ | L2 è¿è¡Œæ—¶ | L3 å·¥å…· | L4 ç¼–æ’ | L5 ç•Œé¢ |
|-------------------|--------|----------|--------|--------|--------|
| **L5 ç•Œé¢** | - | - | - | âœ… Runtime | - |
| **L4 ç¼–æ’** | âœ… Memory | âœ… LLM/Cost | âœ… Skills | âœ… Internal | - |
| **L3 å·¥å…·** | - | âœ… LLM | - | - | - |
| **L2 è¿è¡Œæ—¶** | - | - | - | - | - |
| **L1 å­˜å‚¨** | - | - | - | - | - |

### æ‰©å±•ç‚¹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       ç³»ç»Ÿæ‰©å±•ç‚¹                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                          â”‚
â”‚  1. æ–°å¢æŠ€èƒ½ (Skill)                                      â”‚
â”‚     â†’ å®ç° Skill æ¥å£                                     â”‚
â”‚     â†’ åœ¨ SkillEngine æ³¨å†Œ                                 â”‚
â”‚     â†’ IntentRouter è‡ªåŠ¨è¯†åˆ«                               â”‚
â”‚                                                          â”‚
â”‚  2. æ–°å¢ LLM æä¾›å•†                                       â”‚
â”‚     â†’ ç»§æ‰¿ LLMProvider åŸºç±»                               â”‚
â”‚     â†’ å®ç° chat/chatStream æ–¹æ³•                           â”‚
â”‚     â†’ åœ¨ LLMManager æ³¨å†Œ                                  â”‚
â”‚                                                          â”‚
â”‚  3. æ–°å¢ UI ç»„ä»¶                                          â”‚
â”‚     â†’ é€šè¿‡ AgentRuntime.getInstance() è·å–è¿è¡Œæ—¶           â”‚
â”‚     â†’ è®¢é˜…ç›¸å…³äº‹ä»¶                                        â”‚
â”‚     â†’ è°ƒç”¨è¿è¡Œæ—¶æ–¹æ³•                                      â”‚
â”‚                                                          â”‚
â”‚  4. æ–°å¢å·¥å…· (Tool)                                       â”‚
â”‚     â†’ å®ç°å·¥å…·æ¥å£                                        â”‚
â”‚     â†’ é€šè¿‡ SkillContext æ³¨å…¥æŠ€èƒ½                          â”‚
â”‚                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## é™„å½•

### æ–‡ä»¶ç›®å½•å¯¹åº”

```
docs/.vitepress/
â”œâ”€â”€ agent/                         # L4 ç¼–æ’å±‚ + L3 å·¥å…·å±‚
â”‚   â”œâ”€â”€ core/                      #   IntentRouter, StateMachine
â”‚   â”œâ”€â”€ skills/                    #   SkillEngine
â”‚   â”œâ”€â”€ memory/                    #   MemoryManager (L1 æ¥å£)
â”‚   â”œâ”€â”€ llm/                       # L2 LLM Manager
â”‚   â”œâ”€â”€ runtime/                   # L2 Logger, CostTracker
â”‚   â””â”€â”€ config/                    #   é…ç½®ç®¡ç†
â”‚
â”œâ”€â”€ theme/components/agent/        # L5 ç•Œé¢å±‚
â”‚   â”œâ”€â”€ AIChatOrb.vue
â”‚   â”œâ”€â”€ GlobalPageEditorAGI.vue
â”‚   â”œâ”€â”€ AgentModeToggle.vue
â”‚   â””â”€â”€ ...
â”‚
â”œâ”€â”€ memory/                        # L1 å­˜å‚¨å±‚ (æ–°å¢)
â”‚   â”œâ”€â”€ entities/
â”‚   â”œâ”€â”€ tasks/
â”‚   â””â”€â”€ ...
â”‚
â””â”€â”€ history/                       # L1 å­˜å‚¨å±‚ (åŸæœ‰)
```

---

*æ–‡æ¡£ç‰ˆæœ¬: 1.0*  
*å…³è”æ–‡æ¡£: [åŸæœ‰åšå®¢æ¶æ„](./blog-vitepress.md), [æ•´ä½“æ¶æ„æ¦‚è§ˆ](./overview.md)*
