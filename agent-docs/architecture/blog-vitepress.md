# åŸæœ‰åšå®¢æ¶æ„è¯¦è§£ (VitePress-Based)

> **ã€æ€»-åˆ†-æ€»ã€‘åŸæœ‰ MetaUniverse Blog æ¶æ„**
> 
> æœ¬æ–‡æ¡£è¯¦ç»†æè¿°åŸæœ‰åšå®¢ç³»ç»Ÿçš„è®¾è®¡ï¼ŒåŒ…æ‹¬æ ¸å¿ƒåŠŸèƒ½ã€æŠ€æœ¯é€‰å‹å’Œæ•°æ®æµã€‚

---

## ã€æ€»ã€‘ç³»ç»Ÿæ¦‚è¿°

åŸæœ‰ MetaUniverse Blog æ˜¯ä¸€ä¸ªåŸºäº **VitePress** çš„é™æ€åšå®¢ç³»ç»Ÿï¼Œä¸“ä¸ºæŠ€æœ¯å†™ä½œè€…è®¾è®¡ï¼Œå¼ºè°ƒçŸ¥è¯†çš„è¿æ¥æ€§å’Œå¯è¿½æº¯æ€§ã€‚

### æ ¸å¿ƒè®¾è®¡ç†å¿µ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    çŸ¥è¯†ç½‘ç»œ (Knowledge Network)                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  ä¼ ç»Ÿåšå®¢                    MetaUniverse Blog                  â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€                   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                  â”‚
â”‚  å­¤ç«‹çš„æ–‡ç«       â†’           è¿æ¥çš„çŸ¥è¯†ç½‘ç»œ                      â”‚
â”‚  çº¿æ€§æ—¶é—´è½´      â†’           å¯å›æº¯çš„æ¼”è¿›å†å²                    â”‚
â”‚  é™æ€å±•ç¤º        â†’           å¯äº¤äº’çš„æ¢ç´¢                        â”‚
â”‚                                                                 â”‚
â”‚  æ ¸å¿ƒæœºåˆ¶ï¼š                                                      â”‚
â”‚  â€¢ WikiLinks: [[æ¦‚å¿µ]] è¯­æ³•å»ºç«‹çŸ¥è¯†è¿æ¥                         â”‚
â”‚  â€¢ Git History: å®Œæ•´çš„ç¼–è¾‘æ¼”è¿›è½¨è¿¹                               â”‚
â”‚  â€¢ Knowledge Graph: å¯è§†åŒ–çš„çŸ¥è¯†ç½‘ç»œ                            â”‚
â”‚  â€¢ Shadow Files: ä»£ç å³æ–‡æ¡£                                     â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### åŠŸèƒ½ç‰¹æ€§æ€»è§ˆ

| åŠŸèƒ½ | æè¿° | æŠ€æœ¯å®ç° |
|------|------|---------|
| **GlobalPageEditor** | å…¨å±€ Markdown ç¼–è¾‘å™¨ | Vditor + BFF API |
| **HistoryViewer** | æ–‡ä»¶å†å²æŸ¥çœ‹ä¸å›æ»š | Git Log + Diff |
| **KnowledgeGraph** | çŸ¥è¯†å›¾è°±å¯è§†åŒ– | Cytoscape.js |
| **RAGSearch** | æ™ºèƒ½æœç´¢ | FlexSearch + æ¨¡æ‹Ÿ RAG |
| **ShadowFiles** | ä»£ç è‡ªåŠ¨è½¬æ–‡æ¡£ | chokidar + æ¨¡æ¿ç”Ÿæˆ |

---

## ã€åˆ†ã€‘æ ¸å¿ƒåŠŸèƒ½è¯¦è§£

### 1. GlobalPageEditor - å…¨å±€é¡µé¢ç¼–è¾‘å™¨

**ã€æ€»ã€‘åŠŸèƒ½å®šä½**

æä¾›æ²‰æµ¸å¼çš„ Markdown ç¼–è¾‘ä½“éªŒï¼Œæ”¯æŒè‡ªåŠ¨ä¿å­˜ã€å¤§çº²å¯¼èˆªã€å®æ—¶é¢„è§ˆã€‚

**ã€åˆ†ã€‘ç•Œé¢ç»“æ„**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ é¡¶éƒ¨å·¥å…·æ                                                        â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚ â”‚ ğŸ’¾ ä¿å­˜      â”‚ â”‚ ğŸ“„ å¤§çº²      â”‚ â”‚ âœ“ å®Œæˆ       â”‚             â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  ç¼–è¾‘åŒºåŸŸ (Vditor)                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ # æ–‡ç« æ ‡é¢˜                                                 â”‚ â”‚
â”‚  â”‚                                                           â”‚ â”‚
â”‚  â”‚ æ­£æ–‡å†…å®¹æ”¯æŒ [[WikiLinks]] è¯­æ³•...                        â”‚ â”‚
â”‚  â”‚                                                           â”‚ â”‚
â”‚  â”‚ ## ç« èŠ‚æ ‡é¢˜                                                â”‚ â”‚
â”‚  â”‚                                                           â”‚ â”‚
â”‚  â”‚ ```python                                                 â”‚ â”‚
â”‚  â”‚ # ä»£ç å—                                                   â”‚ â”‚
â”‚  â”‚ ```                                                       â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ åº•éƒ¨çŠ¶æ€æ                                                        â”‚
â”‚ å­—æ•°: 1,240        æœ€åä¿å­˜: 10så‰        è‡ªåŠ¨ä¿å­˜: âœ“          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ã€åˆ†ã€‘æŠ€æœ¯å®ç°**

```typescript
// GlobalPageEditor.vue æ ¸å¿ƒé€»è¾‘
interface EditorState {
  content: string
  isSaving: boolean
  lastSaved: number
  outline: OutlineItem[]
}

// è‡ªåŠ¨ä¿å­˜æœºåˆ¶
const autoSave = debounce(async (content: string) => {
  await fetch('/api/files/save', {
    method: 'POST',
    body: JSON.stringify({ path: currentFile.value, content })
  })
  state.lastSaved = Date.now()
}, 3000)  // 3ç§’é˜²æŠ–

// å¤§çº²ç”Ÿæˆ
function generateOutline(content: string): OutlineItem[] {
  const headings = content.match(/^#{1,6}\s+.+$/gm) || []
  return headings.map(h => {
    const level = h.match(/^#+/)![0].length
    const text = h.replace(/^#+\s+/, '')
    return { level, text, id: slugify(text) }
  })
}
```

**ã€åˆ†ã€‘æ•°æ®æµ**

```
ç”¨æˆ·è¾“å…¥
    â†“
VditorEditor (onChange)
    â†“
å†…å®¹æ›´æ–°åˆ°æœ¬åœ°çŠ¶æ€
    â†“
è§¦å‘è‡ªåŠ¨ä¿å­˜ï¼ˆé˜²æŠ– 3sï¼‰
    â†“
POST /api/files/save
    â†“
æœåŠ¡ç«¯ä¿å­˜æ–‡ä»¶
    â†“
Git è‡ªåŠ¨æäº¤ï¼ˆå¯é€‰ï¼‰
    â†“
è¿”å›ä¿å­˜æˆåŠŸ
    â†“
æ›´æ–° lastSaved çŠ¶æ€
```

**ã€æ€»ã€‘è®¾è®¡è¦ç‚¹**

```
âœ… è‡ªåŠ¨ä¿å­˜ï¼Œé˜²æ­¢æ•°æ®ä¸¢å¤±
âœ… å¤§çº²å¯¼èˆªï¼Œå¿«é€Ÿè·³è½¬ç« èŠ‚
âœ… æ”¯æŒ WikiLinks è¯­æ³•é«˜äº®
âœ… å®æ—¶é¢„è§ˆï¼Œæ‰€è§å³æ‰€å¾—
âœ… å¿«æ·é”®æ”¯æŒï¼ˆCtrl+S ä¿å­˜ï¼‰
```

---

### 2. HistoryViewer - å†å²æŸ¥çœ‹å™¨

**ã€æ€»ã€‘åŠŸèƒ½å®šä½**

æŸ¥çœ‹æ–‡ä»¶çš„ç¼–è¾‘å†å²ï¼Œæ”¯æŒ Diff å¯¹æ¯”å’Œç‰ˆæœ¬å›æ»šã€‚

**ã€åˆ†ã€‘ç•Œé¢ç»“æ„**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å†å²æŸ¥çœ‹å™¨                                          [âœ•] å…³é—­   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æ–‡ä»¶å†å²    â”‚ æ–‡ä»¶å¤¹å†å²                                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚ æäº¤åˆ—è¡¨                          â”‚  Diff å¯¹æ¯”                    â”‚
â”‚                                   â”‚                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ abc1234 æ›´æ–°é¦–é¡µå†…å®¹         â”‚  â”‚  â”‚ - æ—§å†…å®¹               â”‚ â”‚
â”‚  â”‚ 2å°æ—¶å‰ â€¢ ä½œè€…              â”‚  â”‚  â”‚ + æ–°å†…å®¹               â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚                        â”‚ â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚ @@ -1,5 +1,5 @@       â”‚ â”‚
â”‚  â”‚ def5678 æ·»åŠ æ–°æ®µè½           â”‚  â”‚  â”‚  - åˆ é™¤çš„è¡Œ           â”‚ â”‚
â”‚  â”‚ æ˜¨å¤© â€¢ ä½œè€…                 â”‚  â”‚  â”‚  + æ·»åŠ çš„è¡Œ           â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚                        â”‚ â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  â”‚ hij9012 åˆå§‹åŒ–æ–‡ç«           â”‚  â”‚                              â”‚
â”‚  â”‚ 3å¤©å‰ â€¢ ä½œè€…                â”‚  â”‚  [å›æ»šåˆ°æ­¤ç‰ˆæœ¬]              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚                              â”‚
â”‚                                   â”‚                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ã€åˆ†ã€‘æŠ€æœ¯å®ç°**

```typescript
// HistoryViewer.vue æ ¸å¿ƒé€»è¾‘
interface CommitInfo {
  hash: string
  message: string
  author: string
  date: string
  body?: string
}

// åŠ è½½æäº¤å†å²
async function loadHistory(path: string): Promise<CommitInfo[]> {
  const res = await fetch(`/api/git/log?path=${encodeURIComponent(path)}`)
  const logs = await res.json()
  return logs.map((log: any) => ({
    hash: log.hash.substring(0, 7),
    message: log.message.split('\n')[0],
    author: log.author_name,
    date: formatRelativeTime(log.date)
  }))
}

// æŸ¥çœ‹ Diff
async function viewDiff(from: string, to: string) {
  const res = await fetch(`/api/git/diff?from=${from}&to=${to}`)
  const { diff } = await res.json()
  diffHtml.value = renderDiff(diff)  // ä½¿ç”¨ diff2html æˆ–è‡ªå®šä¹‰æ¸²æŸ“
}

// å›æ»šç‰ˆæœ¬
async function rollback(commitHash: string) {
  if (!confirm('ç¡®å®šè¦å›æ»šåˆ°è¿™ä¸ªç‰ˆæœ¬å—ï¼Ÿ')) return
  
  await fetch('/api/git/checkout', {
    method: 'POST',
    body: JSON.stringify({ commit: commitHash, path: currentFile.value })
  })
  
  // é‡æ–°åŠ è½½æ–‡ä»¶å†…å®¹
  await reloadContent()
}
```

**ã€åˆ†ã€‘Git é›†æˆ API**

```typescript
// server/routes/git.ts
import simpleGit from 'simple-git'

const git = simpleGit('docs')

// è·å–æäº¤æ—¥å¿—
app.get('/api/git/log', async (req, res) => {
  const { path } = req.query
  const log = await git.log({ file: path as string })
  res.json(log.all)
})

// è·å– Diff
app.get('/api/git/diff', async (req, res) => {
  const { from, to } = req.query
  const diff = await git.diff([`${from}..${to}`])
  res.json({ diff })
})

// å›æ»šåˆ°æŒ‡å®šç‰ˆæœ¬
app.post('/api/git/checkout', async (req, res) => {
  const { commit, path } = req.body
  await git.checkout(commit, [path])
  res.json({ success: true })
})
```

---

### 3. KnowledgeGraph - çŸ¥è¯†å›¾è°±

**ã€æ€»ã€‘åŠŸèƒ½å®šä½**

å¯è§†åŒ–å±•ç¤º WikiLinks æ„æˆçš„çŸ¥è¯†ç½‘ç»œï¼Œæ”¯æŒèŠ‚ç‚¹æ¢ç´¢ã€‚

**ã€åˆ†ã€‘æ•°æ®ç»“æ„**

```typescript
// å›¾è°±èŠ‚ç‚¹
interface GraphNode {
  id: string           // èŠ‚ç‚¹ IDï¼ˆæ–‡ç« è·¯å¾„æˆ–æ¦‚å¿µåï¼‰
  label: string        // æ˜¾ç¤ºæ ‡ç­¾
  type: 'article' | 'concept' | 'code' | 'external'
  url?: string         // è·³è½¬é“¾æ¥
  color?: string       // èŠ‚ç‚¹é¢œè‰²
  size?: number        // èŠ‚ç‚¹å¤§å°
}

// å›¾è°±è¾¹
interface GraphEdge {
  source: string       // æºèŠ‚ç‚¹ ID
  target: string       // ç›®æ ‡èŠ‚ç‚¹ ID
  label?: string       // è¾¹æ ‡ç­¾
  color?: string       // è¾¹é¢œè‰²
}

// å›¾è°±æ•°æ®
interface GraphData {
  nodes: GraphNode[]
  edges: GraphEdge[]
}
```

**ã€åˆ†ã€‘WikiLinks è§£æ**

```typescript
// ä» Markdown æå– WikiLinks
function extractWikiLinks(content: string, sourceFile: string): GraphEdge[] {
  const wikiLinkRegex = /\[\[([^\]|]+)(?:\|[^\]]+)?\]\]/g
  const edges: GraphEdge[] = []
  
  let match
  while ((match = wikiLinkRegex.exec(content)) !== null) {
    const target = match[1].trim()
    edges.push({
      source: sourceFile,
      target: normalizePath(target),
      label: 'links to'
    })
  }
  
  return edges
}

// æ„å»ºå®Œæ•´å›¾è°±
async function buildKnowledgeGraph(): Promise<GraphData> {
  const articles = await getAllArticles()
  const nodes: GraphNode[] = []
  const edges: GraphEdge[] = []
  const nodeSet = new Set<string>()
  
  for (const article of articles) {
    // æ·»åŠ æ–‡ç« èŠ‚ç‚¹
    if (!nodeSet.has(article.path)) {
      nodes.push({
        id: article.path,
        label: article.title,
        type: 'article',
        url: article.url,
        color: '#4a90e2'
      })
      nodeSet.add(article.path)
    }
    
    // æå–é“¾æ¥
    const links = extractWikiLinks(article.content, article.path)
    
    for (const link of links) {
      // æ·»åŠ ç›®æ ‡èŠ‚ç‚¹ï¼ˆå¦‚æœä¸å­˜åœ¨ï¼‰
      if (!nodeSet.has(link.target)) {
        const exists = await articleExists(link.target)
        nodes.push({
          id: link.target,
          label: link.target,
          type: exists ? 'concept' : 'external',
          url: exists ? `/${link.target}` : undefined,
          color: exists ? '#50c878' : '#999'
        })
        nodeSet.add(link.target)
      }
      
      edges.push(link)
    }
  }
  
  return { nodes, edges }
}
```

**ã€åˆ†ã€‘å¯è§†åŒ–æ¸²æŸ“**

```vue
<template>
  <div ref="container" class="knowledge-graph"></div>
</template>

<script setup lang="ts">
import cytoscape from 'cytoscape'

const container = ref<HTMLElement>()
let cy: cytoscape.Core

onMounted(async () => {
  const data = await buildKnowledgeGraph()
  
  cy = cytoscape({
    container: container.value,
    elements: [
      ...data.nodes.map(n => ({ data: n })),
      ...data.edges.map(e => ({ data: e }))
    ],
    style: [
      {
        selector: 'node',
        style: {
          'label': 'data(label)',
          'background-color': 'data(color)',
          'width': 'data(size)',
          'height': 'data(size)',
          'font-size': '12px',
          'text-valign': 'center',
          'text-halign': 'center'
        }
      },
      {
        selector: 'edge',
        style: {
          'width': 2,
          'line-color': '#ccc',
          'target-arrow-color': '#ccc',
          'target-arrow-shape': 'triangle',
          'curve-style': 'bezier'
        }
      }
    ],
    layout: {
      name: 'cose',  // åŠ›å¯¼å‘å¸ƒå±€
      padding: 10,
      nodeRepulsion: 4500,
      edgeElasticity: 100,
      gravity: 0.5
    }
  })
  
  // ç‚¹å‡»èŠ‚ç‚¹è·³è½¬
  cy.on('tap', 'node', (evt) => {
    const node = evt.target.data()
    if (node.url) {
      window.open(node.url, '_blank')
    }
  })
})
</script>
```

**ã€æ€»ã€‘è®¾è®¡è¦ç‚¹**

```
âœ… åŠ›å¯¼å‘å¸ƒå±€ï¼Œè‡ªåŠ¨ä¼˜åŒ–èŠ‚ç‚¹ä½ç½®
âœ… é¢œè‰²åŒºåˆ†ï¼šæ–‡ç« (è“)ã€æ¦‚å¿µ(ç»¿)ã€å¤–éƒ¨(ç°)
âœ… ç‚¹å‡»èŠ‚ç‚¹è·³è½¬å¯¹åº”é¡µé¢
âœ… æ”¯æŒç¼©æ”¾å’Œå¹³ç§»
âœ… å®æ—¶å“åº”æ•°æ®å˜åŒ–
```

---

### 4. RAGSearch - æ™ºèƒ½æœç´¢

**ã€æ€»ã€‘åŠŸèƒ½å®šä½**

æä¾›æ¯”ä¼ ç»Ÿæœç´¢æ›´æ™ºèƒ½çš„æ£€ç´¢ä½“éªŒï¼Œå±•ç¤ºç›¸å…³ä¸Šä¸‹æ–‡è€Œéä»…æ ‡é¢˜åŒ¹é…ã€‚

**ã€åˆ†ã€‘å½“å‰å®ç° (FlexSearch)

```typescript
// åŸºäº FlexSearch çš„æœ¬åœ°æœç´¢
import FlexSearch from 'flexsearch'

// åˆ›å»ºç´¢å¼•
const index = new FlexSearch.Document({
  document: {
    id: 'path',
    index: ['title', 'content']
  }
})

// æ·»åŠ æ–‡æ¡£åˆ°ç´¢å¼•
async function buildSearchIndex() {
  const articles = await getAllArticles()
  
  for (const article of articles) {
    index.add({
      path: article.path,
      title: article.title,
      content: article.content.substring(0, 10000)  // é™åˆ¶é•¿åº¦
    })
  }
}

// æœç´¢
function search(query: string): SearchResult[] {
  const results = index.search(query, { limit: 10 })
  
  return results.map(r => ({
    path: r.id,
    title: r.doc.title,
    excerpt: generateExcerpt(r.doc.content, query),
    score: r.score
  }))
}

// ç”Ÿæˆæ‘˜è¦
function generateExcerpt(content: string, query: string): string {
  const index = content.toLowerCase().indexOf(query.toLowerCase())
  if (index === -1) return content.substring(0, 200) + '...'
  
  const start = Math.max(0, index - 100)
  const end = Math.min(content.length, index + query.length + 100)
  
  return (start > 0 ? '...' : '') + 
         content.substring(start, end) + 
         (end < content.length ? '...' : '')
}
```

**ã€åˆ†ã€‘æ¨¡æ‹Ÿ RAG å±•ç¤º**

```
æœç´¢ç»“æœé¡µé¢
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ” æœç´¢ç»“æœ: "RAG æŠ€æœ¯"                                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ğŸ“„ åŸºäº RAG çš„ LLM åº”ç”¨                                  â”‚   â”‚
â”‚  â”‚                                                         â”‚   â”‚
â”‚  â”‚ ...æ£€ç´¢å¢å¼ºç”Ÿæˆï¼ˆRAGï¼‰æ˜¯ä¸€ç§ç»“åˆæ£€ç´¢å’Œç”Ÿæˆçš„æŠ€æœ¯...      â”‚   â”‚
â”‚  â”‚                                                         â”‚   â”‚
â”‚  â”‚ ç›¸å…³åº¦: 95%  â€¢  æ¥æº: posts/rag-application.md          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ğŸ“„ LLM æ¶æ„è®¾è®¡                                          â”‚   â”‚
â”‚  â”‚                                                         â”‚   â”‚
â”‚  â”‚ ...RAG æ¨¡å¼å¯ä»¥æœ‰æ•ˆè§£å†³å¤§æ¨¡å‹çš„å¹»è§‰é—®é¢˜...               â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 5. Shadow Files - ä»£ç å³æ–‡æ¡£

**ã€æ€»ã€‘åŠŸèƒ½å®šä½**

è‡ªåŠ¨å°†ä»£ç æ–‡ä»¶è½¬æ¢ä¸º Markdown æ–‡æ¡£ï¼Œå®ç°ä»£ç çš„æ–‡æ¡£åŒ–å±•ç¤ºã€‚

**ã€åˆ†ã€‘å·¥ä½œæµç¨‹**

```
code/python/transformer.py  åˆ›å»º/ä¿®æ”¹
            â†“
    chokidar ç›‘å¬åˆ°å˜åŒ–
            â†“
    ShadowFileGenerator å¤„ç†
            â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ 1. è¯»å–ä»£ç æ–‡ä»¶                          â”‚
    â”‚ 2. è¯†åˆ«ç¼–ç¨‹è¯­è¨€                          â”‚
    â”‚ 3. åº”ç”¨ä»£ç é«˜äº®                          â”‚
    â”‚ 4. ç”Ÿæˆ Markdown åŒ…è£…                    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â†“
    ä¿å­˜åˆ° code/python/transformer.py.md
            â†“
    VitePress æ¸²æŸ“ä¸ºé¡µé¢
```

**ã€åˆ†ã€‘å®ç°ä»£ç **

```typescript
// ShadowFileGenerator.ts
import chokidar from 'chokidar'
import fs from 'fs/promises'
import path from 'path'

class ShadowFileGenerator {
  private watcher: chokidar.FSWatcher
  
  constructor(watchDir: string) {
    this.watcher = chokidar.watch(`${watchDir}/**/*.{py,js,ts,java,go,rs}`, {
      ignored: /\.md$/,  // å¿½ç•¥å·²ç”Ÿæˆçš„ md æ–‡ä»¶
      persistent: true
    })
    
    this.watcher
      .on('add', (filePath) => this.generateShadow(filePath))
      .on('change', (filePath) => this.generateShadow(filePath))
      .on('unlink', (filePath) => this.removeShadow(filePath))
  }
  
  async generateShadow(sourcePath: string): Promise<void> {
    const content = await fs.readFile(sourcePath, 'utf-8')
    const ext = path.extname(sourcePath).slice(1)
    const shadowPath = `${sourcePath}.md`
    
    const markdown = this.wrapInMarkdown(sourcePath, content, ext)
    
    await fs.writeFile(shadowPath, markdown)
    console.log(`Generated shadow file: ${shadowPath}`)
  }
  
  private wrapInMarkdown(
    sourcePath: string, 
    content: string, 
    language: string
  ): string {
    const fileName = path.basename(sourcePath)
    
    return `---
title: ${fileName}
codeSource: ${sourcePath}
---

# ${fileName}

> æ­¤æ–‡ä»¶ç”± Shadow File ç³»ç»Ÿè‡ªåŠ¨ç”Ÿæˆ
> 
> æºæ–‡ä»¶: \`${sourcePath}\`

## æºä»£ç 

\`\`\`${language}
${content}
\`\`\`
`
  }
  
  async removeShadow(sourcePath: string): Promise<void> {
    const shadowPath = `${sourcePath}.md`
    try {
      await fs.unlink(shadowPath)
      console.log(`Removed shadow file: ${shadowPath}`)
    } catch {
      // æ–‡ä»¶å¯èƒ½ä¸å­˜åœ¨
    }
  }
}

// ä½¿ç”¨
const generator = new ShadowFileGenerator('docs/code')
```

---

## ã€æ€»ã€‘æŠ€æœ¯æ¶æ„æ€»ç»“

### æŠ€æœ¯æ ˆå…¨æ™¯

```
Frontend (VitePress)
â”œâ”€â”€ VitePress 1.x        # é™æ€ç«™ç‚¹ç”Ÿæˆ
â”œâ”€â”€ Vue 3 + TypeScript   # ç»„ä»¶å¼€å‘
â”œâ”€â”€ Vditor 3.x           # Markdown ç¼–è¾‘å™¨
â”œâ”€â”€ Cytoscape.js 3.x     # å›¾å¯è§†åŒ–
â”œâ”€â”€ FlexSearch 0.7.x     # æœ¬åœ°æœç´¢
â””â”€â”€ Diff.js              # Diff è®¡ç®—

Backend (BFF)
â”œâ”€â”€ Express.js 4.x       # API æœåŠ¡
â”œâ”€â”€ simple-git           # Git æ“ä½œ
â”œâ”€â”€ chokidar             # æ–‡ä»¶ç›‘å¬
â””â”€â”€ CORS / Body Parser   # ä¸­é—´ä»¶

Build & Deploy
â”œâ”€â”€ Vite                 # æ„å»ºå·¥å…·
â”œâ”€â”€ GitHub Actions       # CI/CD
â””â”€â”€ GitHub Pages / Vercel # éƒ¨ç½²
```

### æ•°æ®æµæ€»ç»“

```
ç”¨æˆ·ç¼–è¾‘ (GlobalPageEditor)
    â†“
Vditor (å®æ—¶é¢„è§ˆ)
    â†“
è‡ªåŠ¨ä¿å­˜ â†’ BFF API
    â†“
æ–‡ä»¶ç³»ç»Ÿä¿å­˜
    â†“
Git æäº¤ (å¯é€‰)
    â†“
æ„å»ºæ—¶é‡æ–°ç´¢å¼• (FlexSearch)
    â†“
é™æ€ç«™ç‚¹ç”Ÿæˆ

ä»£ç æ–‡ä»¶ä¿å­˜
    â†“
chokidar ç›‘å¬
    â†“
Shadow File ç”Ÿæˆ
    â†“
åŒ…å«åœ¨æ„å»ºä¸­
```

### ä¸ Agent æ¶æ„çš„èåˆç‚¹

```
åŸæœ‰ç»„ä»¶              èåˆæ–¹å¼                    Agent å¢å¼º
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
GlobalPageEditor  â†’  GlobalPageEditorAGI      ä¸‰æ¨¡æ€ç¼–è¾‘
HistoryViewer     â†’  HistoryViewerAGI         Agent æ“ä½œå†å²
KnowledgeGraph    â†’  KnowledgeGraph + AI      è‡ªåŠ¨çŸ¥è¯†å‘ç°
RAGSearch         â†’  RAGSearch (çœŸå® RAG)      å‘é‡æ£€ç´¢
Shadow Files      â†’  Shadow + AI æ–‡æ¡£         è‡ªåŠ¨ç”Ÿæˆæ•™å­¦æ–‡æ¡£
```

---

*æ–‡æ¡£ç‰ˆæœ¬: 1.0*  
*å…³è”æ–‡æ¡£: [Agent äº”å±‚æ¶æ„](./agent-five-layer.md), [æ•´ä½“æ¶æ„æ¦‚è§ˆ](./overview.md)*
